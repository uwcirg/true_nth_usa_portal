!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=16)}([function(e,t,r){"use strict";t.a={external_study_id:"http://us.truenth.org/identity-codes/external-study-id",external_site_id:"http://us.truenth.org/identity-codes/external-site-id",practice_region:"http://us.truenth.org/identity-codes/practice-region",race:"http://hl7.org/fhir/StructureDefinition/us-core-race",race_system:"http://hl7.org/fhir/v3/Race",ethnicity:"http://hl7.org/fhir/StructureDefinition/us-core-ethnicity",ethnicity_system:"http://hl7.org/fhir/v3/Ethnicity",indigenous:"http://us.truenth.org/fhir/StructureDefinition/AU-NHHD-METeOR-id-291036",timezone:"http://hl7.org/fhir/StructureDefinition/user-timezone",language:"http://hl7.org/fhir/valueset/languages",language_system:"urn:ietf:bcp:47",shortname:"http://us.truenth.org/identity-codes/shortname",SNOMED_SYS_URL:"http://snomed.info/sct",CLINICAL_SYS_URL:"http://us.truenth.org/clinical-codes",CANCER_TREATMENT_CODE:"118877007",NONE_TREATMENT_CODE:"999"}},function(e,t,r){"use strict";r.d(t,"b",function(){return a}),r.d(t,"c",function(){return o});var n,i=((n=function(){this.requestAttempts=0}).prototype.hasValue=function(e){return"null"!==String(e)&&""!==String(e)&&"undefined"!==String(e)},n.prototype.showMain=function(){$("#mainHolder").css({visibility:"visible","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)",filter:"alpha(opacity=100)","-moz-opacity":1,"-khtml-opacity":1,opacity:1})},n.prototype.hideLoader=function(e,t){e?$("#loadingIndicator").hide():setTimeout(function(){$("#loadingIndicator").fadeOut()},t||200)},n.prototype.loader=function(e){if(document.getElementById("fullSizeContainer"))return this.hideLoader(),this.showMain(),!1;if(e)$("#loadingIndicator").show();else if(!this.isDelayLoading()){var t=this;setTimeout(function(){t.showMain()},100),this.hideLoader(!0,350)}},n.prototype.isDelayLoading=function(){return"undefined"!=typeof DELAY_LOADING&&DELAY_LOADING},n.prototype.isTouchDevice=function(){return!0===("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)},n.prototype.getIEVersion=function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return!!e&&parseInt(e[1])},n.prototype.newHttpRequest=function(e,t,r){this.requestAttempts++;var n,i=this;for(var a in r=r||function(){},window.XDomainRequest?(n=new XDomainRequest).onload=function(){r(n.responseText)}:n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4===n.readyState){if(200===n.status)return r(n.responseText),void(i.requestAttempts=0);i.requestAttempts<3?setTimeout(function(){i.newHttpRequest(e,t,r)},3e3):(r({error:n.responseText}),i.loader(),i.requestAttempts=0)}},t=t||{},n.open("GET",e,!0),t)t.hasOwnProperty(a)&&n.setRequestHeader(a,t[a]);t.cache||(n.setRequestHeader("cache-control","no-cache"),n.setRequestHeader("expires","-1"),n.setRequestHeader("pragma","no-cache")),n.send()},n.prototype.ajaxRequest=function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("Url is required.")}),!1;var n={url:e,type:"GET",contentType:"text/plain",timeout:5e3,cache:!1};t=t||n,t=$.extend({},n,t),this.requestAttempts++;var i=this;$.ajax(t).done(function(e){r(e),i.requestAttempts=0}).fail(function(){i.requestAttempts<=3?setTimeout(function(){i.ajaxRequest(e,t,r)},3e3):(r({error:i18next.t("Error occurred processing request")}),i.requestAttempts=0,i.loader())}).always(function(){i.loader()})},n.prototype.initWorker=function(e,t,r){var n=new Worker("/static/js/ajaxWorker.js"),i=this;n.postMessage({url:e,params:t}),n.addEventListener("message",function(e){r.call(i,e.data),n.terminate()},!1),n.addEventListener("error",function(e){console.log("Worker runtime error: Line ",e.lineno," in ",e.filename,": ",e.message),n.terminate()},!1)},n.prototype.workerAllowed=function(){return window.Worker&&!this.isTouchDevice()},n.prototype.getRequestMethod=function(){return this.getIEVersion()?this.newHttpRequest:this.ajaxRequest},n.prototype.sendRequest=function(e,t,r){if((t=t||{}).useWorker&&this.workerAllowed())return this.initWorker(e,t,r),!0;this.getRequestMethod().call(this,e,t,function(e){r.call(this,e)})},n.prototype.LRKeyEvent=function(){$(".button--LR").length>0&&$("html").on("keydown",function(e){parseInt(e.keyCode)===parseInt(187)&&$(".button--LR").toggleClass("data-show")})},n.prototype.getLoaderHTML=function(e){return'<div class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i>'.concat(e?"&nbsp;"+e:"","</div>")},n.prototype.convertToNumericField=function(e){e&&this.isTouchDevice()&&e.each(function(){$(this).prop("type","tel")})},n.prototype.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},n.prototype.disableHeaderFooterLinks=function(){var e=$("#tnthNavWrapper a, #homeFooter a").not("a[href*='logout']").not("a.required-link").not("a.home-link");e.addClass("disabled"),e.prop("onclick",null).off("click"),e.on("click",function(e){return e.preventDefault(),!1})},n.prototype.pad=function(e){return e=parseInt(e),!isNaN(e)&&e<10?"0"+e:e},n.prototype.escapeHtml=function(e){return null===e||"undefined"!==e||0===String(e).length?e:e.replace(/[\"&'\/<>]/g,function(e){return{'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#47;","<":"&lt;",">":"&gt;"}[e]})},n.prototype.containHtmlTags=function(e){return!!e&&/[<>]/.test(e)},n.prototype.getExportFileName=function(e){var t=new Date;return(e||"ExportList_")+("00"+t.getDate()).slice(-2)+("00"+(t.getMonth()+1)).slice(-2)+t.getFullYear()},n.prototype.capitalize=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},n.prototype.restoreVis=function(){var e=document.getElementById("loadingIndicator"),t=document.getElementById("mainHolder");e&&e.setAttribute("style","display:none; visibility:hidden;"),t&&t.setAttribute("style","visibility:visible;-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=100)';filter:alpha(opacity=100); -moz-opacity:1; -khtml-opacity:1; opacity:1")},n.prototype.VueErrorHandling=function(){if("undefined"==typeof Vue)return!1;var e=this;Vue.config.errorHandler=function(t,r,n){var i,a=r;if(r.$options.errorHandler)i=r.$options.errorHandler;else for(;!i&&a.$parent;)i=(a=a.$parent).$options.errorHandler;e.restoreVis(),i?i.call(a,t,r,n):console.log(t)}},n.prototype.extend=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},n.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1])},n.prototype.resetBrowserBackHistory=function(e,t,r){var n="undefined"!=typeof history&&history.pushState;e=e||location.href,n&&history.pushState(t,r,e),window.addEventListener("popstate",function(){n?history.pushState(t,r,e):window.history.forward(1)})},n.prototype.handlePostLogout=function(){if("undefined"==typeof sessionStorage)return!1;sessionStorage.getItem("logout")&&(this.resetBrowserBackHistory(location.orgin,"logout"),sessionStorage.removeItem("logout"))},n.prototype.displaySystemOutageMessage=function(e){if(e=(e=e||"en-us").replace("_","-"),document.getElementById("systemMaintenanceContainer")){var t=this;this.ajaxRequest("api/settings",{contentType:"application/json; charset=utf-8"},function(r){if(!r||!r.MAINTENANCE_MESSAGE&&!r.MAINTENANCE_WINDOW)return!1;var n=document.querySelector(".message-container");if(n||((n=document.createElement("div")).classList.add("message-container"),document.getElementById("systemMaintenanceContainer").appendChild(n)),r.MAINTENANCE_MESSAGE)n.innerHTML=t.escapeHtml(r.MAINTENANCE_MESSAGE);else if(r.MAINTENANCE_WINDOW&&r.MAINTENANCE_WINDOW.length){var i,a,o=new Date(r.MAINTENANCE_WINDOW[0]),s=new Date(r.MAINTENANCE_WINDOW[1]),c=(i=new Date,a=o,i&&a?Math.floor((a.getTime()-i.getTime())/36e5%24):0);if(c<0||isNaN(c))document.getElementById("systemMaintenanceContainer").classList.add("tnth-hide");else try{var u={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0,timeZoneName:"short"},d=o.toLocaleString(e,u).replace(/[,]/g," "),l=s.toLocaleString(e,u).replace(/[,]/g," "),f=["<div>"+i18next.t("Hi there.")+"</div>","<div>"+i18next.t("TrueNTH will be down for website maintenance starting <b>{startdate}</b>. This should last until <b>{enddate}</b>.".replace("{startdate}",d).replace("{enddate}",l))+"</div>","<div>"+i18next.t("Thanks for your patience while we upgrade our site.")+"</div>"].join("");n.innerHTML=t.escapeHtml(f)}catch(e){console.log("Error occurred converting system outage date/time ",e),document.getElementById("systemMaintenanceContainer").classList.add("tnth-hide")}}})}},new n);t.a=i;var a=i.getExportFileName,o=i.getUrlParameter},function(e,t,r){"use strict";r.d(t,"b",function(){return i});var n={validateDateInputFields:function(e,t,r,n){if(!e||!t||!r)return!1;e=parseInt(e),t=parseInt(t),r=parseInt(r);var i=$("#"+n);if(!isNaN(e)&&!isNaN(t)&&!isNaN(r)){var a=new Date,o=new Date(r,e-1,t);return o.getFullYear()!==r||o.getMonth()+1!==e||o.getDate()!==t?(i.html(i18next.t("Invalid date. Please try again.")).show(),!1):o.setHours(0,0,0,0)>a.setHours(0,0,0,0)?(i.html(i18next.t("Date must not be in the future. Please try again.")).show(),!1):r<1900?(i.html(i18next.t("Date must not be before 1900. Please try again.")).show(),!1):(i.html("").hide(),!0)}return!1},swap_mm_dd:function(e){var t=e.split("/");return t[1]+"/"+t[0]+"/"+t[2]},convertMonthNumeric:function(e){if(e){var t={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12}[e.toLowerCase()];return t||""}return""},convertMonthString:function(e){if(e){var t={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}[parseInt(e)];return t||""}return""},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},displayDateString:function(e,t,r){var n="";return n+=t||"",e&&(n+=(n?" ":"")+this.convertMonthString(e)),r&&(n+=(n?" ":"")+r),n},getDateDiff:function(e,t){if(!e)return 0;var r,n=e.split(/[^0-9]/),i=new Date(n[0],n[1]-1,n[2]).getTime();if(t){var a=t.split(/[^0-9]/);r=new Date(a[0],a[1]-1,a[2]).getTime()}else r=(new Date).getTime();return Math.floor((r-i)/864e5)},isValidDefaultDateFormat:function(e,t){if(!e||e.length<10)return!1;var r=$.trim(e).split(" ");if(r.length<3)return!1;var n=parseInt(r[0])+"",i=r[1],a=r[2];if(n.length<1||i.length<3||a.length<4)return!1;if(!/(0)?[1-9]|1\d|2\d|3[01]/.test(n))return!1;if(!/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/i.test(i))return!1;if(!/(19|20)\d{2}/.test(a))return!1;var o=new Date(e);if(this.isDateObj(o)){if(this.isValidDate(a,this.convertMonthNumeric(i),n)){var s=new Date,c="";return o.getFullYear()<1900&&(c="Year must be after 1900"),o.setHours(0,0,0,0)>s.setHours(0,0,0,0)&&(c="The date must not be in the future."),c?($(t).text(c),!1):($(t).text(""),!0)}return!1}return!1},isDateObj:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},isValidDate:function(e,t,r){var n=this.getDateObj(e,t,r),i=this.getConvertedDate(n),a=this.getGivenDate(e,t,r);return String(a)===String(i)},getDateObj:function(e,t,r,n,i,a){return n=n||0,i=i||0,a=a||0,new Date(parseInt(e),parseInt(t)-1,parseInt(r),parseInt(n),parseInt(i),parseInt(a))},getConvertedDate:function(e){return e&&this.isDateObj(e)?""+e.getFullYear()+(e.getMonth()+1)+e.getDate():""},getGivenDate:function(e,t,r){return""+e+t+r},formatDateString:function(e,t){if(e){var r,n,i,a,o,s,c,u=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,d=new Date(e);if(!u&&!isNaN(d)&&!this.isDateObj(d))return"";if(u.test(e)){var l=$.trim($.trim(e).replace(/[\.TZ:\-]/gi," ")).split(" ");i=l[0],n=l[1],r=l[2],a=l[3]||"0",o=l[4]||"0",s=l[5]||"0"}else r=d.getDate(),n=d.getMonth()+1,i=d.getFullYear(),a=d.getHours(),o=d.getMinutes(),s=d.getSeconds(),c="";var f=function(e){return(e=parseInt(e))<10?"0"+e:e};switch(r=f(r),n=f(n),a=f(a),o=f(o),s=f(s),t){case"mm/dd/yyyy":c=n+"/"+r+"/"+i;break;case"mm-dd-yyyy":c=n+"-"+r+"-"+i;break;case"mm-dd-yyyy hh:mm:ss":c=n+"-"+r+"-"+i+" "+a+":"+o+":"+s;break;case"dd/mm/yyyy":c=r+"/"+n+"/"+i;break;case"dd/mm/yyyy hh:mm:ss":c=r+"/"+n+"/"+i+" "+a+":"+o+":"+s;break;case"dd-mm-yyyy":c=r+"-"+n+"-"+i;break;case"dd-mm-yyyy hh:mm:ss":c=r+"-"+n+"-"+i+" "+a+":"+o+":"+s;break;case"iso-short":case"yyyy-mm-dd":c=i+"-"+n+"-"+r;break;case"iso":case"yyyy-mm-dd hh:mm:ss":c=i+"-"+n+"-"+r+" "+a+":"+o+":"+s;break;case"system":c=i+"-"+n+"-"+r+"T"+a+":"+o+":"+s+"Z";break;case"d M y hh:mm:ss":c=(c=this.displayDateString(n,r,i))+" "+a+":"+o+":"+s;break;case"d M y":default:c=this.displayDateString(n,r,i)}return c}return""},convertToLocalTime:function(e){var t="";if(e){var r=new Date(e),n=new Date(r.getTime()+60*r.getTimezoneOffset()*1e3),i=r.getTimezoneOffset()/60,a=r.getHours();n.setHours(a-i);t=n.toLocaleString({year:"numeric",day:"numeric",month:"short",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1})}return t},getDateWithTimeZone:function(e){var t=new Date(e.getTime()+60*e.getTimezoneOffset()*1e3);return this.formatDateString(t,"yyyy-mm-dd hh:mm:ss")},getTodayDateObj:function(){var e=new Date,t=e.getDate(),r=e.getMonth()+1,n=e.getFullYear(),i=e.getHours(),a=e.getMinutes(),o=e.getSeconds(),s=this.getDateWithTimeZone(this.getDateObj(n,r,t,i,a,o)),c=function(e){return(e=parseInt(e))<10?"0"+e:e};return{date:e,day:t,month:r,year:n,hour:i,minute:a,second:o,displayDay:c(t),displayMonth:c(r),displayYear:c(n),displayHour:c(i),displayMinute:c(a),displaySecond:c(o),gmtDate:s}},dateValidator:function(e,t,r,n){var i="";if(e&&t&&r){var a=parseInt(r),o=parseInt(t),s=parseInt(e),c=new Date(a,o-1,s);if(c.getFullYear()===a&&c.getMonth()+1===o&&c.getDate()===s){if(a<1900&&(i=i18next.t("Year must be after 1900")),n){var u=new Date;c.setHours(0,0,0,0)>u.setHours(0,0,0,0)&&(i=i18next.t("The date must not be in the future."))}}else i=i18next.t("Invalid Date. Please enter a valid date.")}else i=i18next.t("Missing value.");return i}};t.a=n;var i=n.validateDateInputFields},function(e,t,r){"use strict";var n=r(1),i=r(2),a=r(0),o={biopsy:{code:"111",display:"biopsy"},pca_diag:{code:"121",display:"PCa diagnosis"},pca_localized:{code:"141",display:"PCa localized diagnosis"}};t.a={beforeSend:function(){$.ajaxSetup({beforeSend:function(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",$("#__CRSF_TOKEN").val())}})},sendRequest:function(e,t,r,i,a){if(!e)return!1;var o={type:t||"GET",url:e,attempts:0,max_attempts:3,contentType:"application/json; charset=utf-8",dataType:"json",sync:!1,timeout:5e3,data:null,useWorker:!1,async:!0};i=i||o,(i=$.extend({},o,i)).async=!i.sync&&i.async;var s=this,c=this.FieldLoaderHelper,u=i.targetField||null;if(a=a||function(){},i.attempts++,c.showLoader(u),i.useWorker&&window.Worker&&!n.a.isTouchDevice())return n.a.initWorker(e,i,function(t){var n;try{n=JSON.parse(t)}catch(t){return a({error:"Error occurred parsing data for "+e}),!1}n?n.error?(a({error:!0,data:n}),s.sendError(n,e,r,i),c.showError(u)):(a(n),c.showUpdate(u)):(a({error:!0,data:"no data returned"}),c.showError(u))}),!0;i.cache||(i.headers={"cache-control":"no-cache",expires:"-1",pragma:"no-cache"}),$.ajax(i).done(function(e){i.attempts=0,e?(c.showUpdate(u),a(e)):(c.showError(u),a({error:!0,data:"no data returned"}))}).fail(function(n){i.attempts<i.max_attempts?function(e,t,r,n,i,a){setTimeout(function(){e.sendRequest(t,r,n,i,a)},3e3)}(s,e,t,r,i,a):(i.attempts=0,c.showError(u),a({error:!0,data:n}),s.sendError(n,e,r,i))})},sendError:function(e,t,r,n){if(!e)return!1;var i="[Error occurred processing request]  status - "+(0===parseInt(e.status)?"request timed out/network error":e.status)+", response text - "+(e.responseText?e.responseText:"no response text returned from server");if(n)try{i+=" [data sent]: "+JSON.stringify(n)}catch(e){i+=" Error occurred transforming sent data: "+e.message}this.reportError(r||"Not available",t,i,!0)},reportError:function(e,t,r,n){var i={};t=t||window.location.href,i.subject_id=e||0,i.page_url=t,i.message="Error generated in JS - "+(r?r.replace(/["']/g,""):"no detail available"),console.log("Errors occurred....."),console.log(i),$.ajax({type:"GET",url:"/report-error",contentType:"application/json; charset=utf-8",cache:!1,async:!n,data:i}).done(function(){}).fail(function(){})},FieldLoaderHelper:{delayDuration:300,showLoader:function(e){if(!e||0===e.length)return!1;var t=$("#"+(e.attr("data-save-container-id")||e.attr("id"))+"_load");t.css("opacity",1),t.addClass("loading")},showUpdate:function(e){var t=this.delayDuration;if(!e||0===e.length)return!1;setTimeout(function(){!function(e){var r=e.attr("data-save-container-id")||e.attr("id"),n=$("#"+r+"_error"),i=$("#"+r+"_success"),a=$("#"+r+"_load");a.removeClass("loading"),n.text("").css("opacity",0),i.text(i18next.t("success")),a.animate({opacity:0},t,function(){i.animate({opacity:1},t,function(){setTimeout(function(){i.animate({opacity:0},2*t)},2*t)})})}(e)},t)},showError:function(e){e=e||$(e);var t=this.delayDuration;if(!e||0===e.length)return!1;setTimeout(function(){!function(e){var r=e.attr("data-save-container-id")||e.attr("id"),n=$("#"+r+"_error"),i=$("#"+r+"_success"),a=$("#"+r+"_load");a.removeClass("loading"),n.text(i18next.t("Unable to update. System/Server Error.")),i.text("").css("opacity",0),a.animate({opacity:0},t,function(){n.animate({opacity:1},t,function(){setTimeout(function(){n.animate({opacity:0},2*t)},2*t)})})}(e)},t)}},getCurrentUser:function(e,t){e=e||function(){},sessionStorage.currentUser?e(JSON.parse(sessionStorage.currentUser)):this.sendRequest("/api/me","GET","",t,function(t){t&&t.id&&sessionStorage.setItem("currentUser",JSON.stringify(t)),e(t)})},getStillNeededCoreData:function(e,t,r,n){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;var i="/api/coredata/user/"+e+"/still_needed"+(n?"?entry_method="+n.replace(/\_/g," "):"");this.sendRequest(i,"GET",e,{sync:t,cache:!0},function(e){return e?e.error?(r({error:i18next.t("unable to get needed core data")}),!1):void r(e):(r({error:i18next.t("no data returned")}),!1)})},getRequiredCoreData:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;this.sendRequest("/api/coredata/user/"+e+"/required","GET",e,{sync:t,cache:!0},function(e){e?e.error?r({error:i18next.t("unable to get required core data")}):e.required?r(e.required):r({error:i18next.t("no data returned")}):r({error:i18next.t("no data returned")})})},getOptionalCoreData:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;var n="/api/coredata/user/"+e+"/optional",i="optionalCoreData_"+e;sessionStorage.getItem(i)?r(JSON.parse(sessionStorage.getItem(i))):this.sendRequest(n,"GET",e,t,function(e){r(e||{error:i18next.t("no data found")})})},getPortalFooter:function(e,t,r,n){if(n=n||function(){},!e)return n("<div class='error-message'>"+i18next.t("User Id is required")+"</div>"),!1;this.sendRequest("/api/portal-footer-html/","GET",e,{sync:t,cache:!0,dataType:"html"},function(e){e?e.error?n("<div class='error-message'>"+i18next.t("Unable to retrieve portal footer html")+"</div>"):(r&&$("#"+r).html(e),n(e)):n("<div class='error-message'>"+i18next.t("No data found")+"</div>")})},getOrgs:function(e,t,r){r=r||function(){},this.sendRequest("/api/organization","GET",e,t,function(e){if(sessionStorage.demoOrgsData)return r(JSON.parse(sessionStorage.demoOrgsData)),!0;if(e.error){var t=i18next.t("Server error occurred retrieving organization/clinic information.");$(".get-orgs-error").html(t),r({error:t})}else $(".get-orgs-error").html(""),sessionStorage.setItem("demoOrgsData",JSON.stringify(e)),r(e)})},getConsent:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/consent","GET",e,t,function(e){if(e){if(e.error){var t=i18next.t("Server error occurred retrieving consent information.");return r({error:t}),$(".get-consent-error").html(t),!1}return $(".get-consent-error").html(""),r(e),!0}})},setConsent:function(e,t,r,n,i){if(i=i||function(){},!e&&!t)return i({error:i18next.t("User id and parameters are required")}),!1;var a="/api/user/"+e+"/consent";if(!this.hasConsent(e,t.org,r)||t.testPatient){var o={};o.user_id=e,o.organization_id=t.org,o.agreement_url=t.agreementUrl,o.staff_editable="null"!==String(t.staff_editable)&&"undefined"!==String(t.staff_editable)&&t.staff_editable,o.include_in_reports="null"!==String(t.include_in_reports)&&"undefined"!==String(t.include_in_reports)&&t.include_in_reports,o.send_reminders="null"!==String(t.send_reminders)&&"undefined"!==String(t.send_reminders)&&t.send_reminders,t.acceptance_date&&(o.acceptance_date=t.acceptance_date),this.sendRequest(a,"POST",e,{sync:n,data:JSON.stringify(o)},function(e){if(e.error){var t=i18next.t("Server error occurred setting consent status.");i({error:t}),$(".set-consent-error").html(t)}else $(".set-consent-error").html(""),i(e)})}else i({error:!1})},deleteConsent:function(e,t){if(!e)return!1;t=t||{};var r=this.getAllValidConsent(e,t.org);if(!r)return!1;var n=t.exclude?t.exclude.split(","):[],i=$.grep(r,function(e){return!$.grep(n,function(t){return String(t)===String(e)}).length}),a=this;i.forEach(function(t){a.sendRequest("/api/user/"+e+"/consent","DELETE",e,{data:JSON.stringify({organization_id:parseInt(t)})},function(e){if(!e)return!1;e.error?$(".delete-consent-error").html(i18next.t("Server error occurred removing consent.")):$(".delete-consent-error").html("")})})},withdrawConsent:function(e,t,r,n){if(n=n||function(){},r=r||{},!e||!t)return n({error:i18next.t("User id and organization id are required.")}),!1;var a=this,o=[];this.sendRequest("/api/user/"+e+"/consent","GET",e,r,function(s){if(s&&s.consent_agreements&&s.consent_agreements.length&&(o=$.grep(s.consent_agreements,function(e){var r=i.a.getDateDiff(String(e.expires));return!(String(t)!==String(e.organization_id)||e.deleted||r>0||"suspended"!==String(e.status))})),o.length)return n({data:"success"}),!1;a.sendRequest("/api/user/"+e+"/consent/withdraw","POST",e,{sync:r.sync,data:JSON.stringify({organization_id:t})},function(e){if(e.error)return n({error:i18next.t("Error occurred setting suspended consent status.")}),!1;n(e)})})},getAllValidConsent:function(e,t){if(!e||!t)return!1;var r=[];return this.sendRequest("/api/user/"+e+"/consent","GET",e,{sync:!0},function(e){return e&&!e.error&&e.consent_agreements&&e.consent_agreements.length?r=(r=$.grep(e.consent_agreements,function(e){var r=i.a.getDateDiff(String(e.expires));return!(e.deleted||r>0||"all"!==String(t).toLowerCase()&&String(t)!==String(e.organization_id))})).map(function(e){return e.organization_id}):r}),r},hasConsent:function(e,t,r){if(!e||!t||"default"===String(r))return!1;var n=[],a="/api/user/"+e+"/consent";return this.sendRequest(a,"GET",e,{sync:!0},function(e){if(!e||e.error||e.consent_agreements&&0===e.consent_agreements.length)return!1;n=$.grep(e.consent_agreements,function(e){var r=e.expires?i.a.getDateDiff(String(e.expires)):0;return String(t)===String(e.organization_id)&&!e.deleted&&!(r>0)&&e.staff_editable&&e.send_reminders&&e.include_in_reports})}),n.length},getDemo:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;t=t||{};var n="demoData_"+e;sessionStorage.getItem(n)?r(JSON.parse(sessionStorage.getItem(n))):this.sendRequest("/api/demographics/"+e,"GET",e,t,function(e){var t="";if(e.error)return t=i18next.t("Server error occurred retrieving demographics information."),$(".get-demo-error").html(t),r({error:t}),!1;$(".get-demo-error").html(t),sessionStorage.setItem(n,JSON.stringify(e)),r(e)})},clearDemoSessionData:function(e){sessionStorage.removeItem("demoData_"+e)},putDemo:function(e,t,r,n,i){if(i=i||function(){},!e)return i({error:i18next.t("User Id is required")}),!1;this.clearDemoSessionData(e),this.sendRequest("/api/demographics/"+e,"PUT",e,{sync:n,data:JSON.stringify(t),targetField:r},function(e){e.error?$(".put-demo-error").html(i18next.t("Server error occurred setting demographics information.")):$(".put-demo-error").html(""),i(e)})},getLocale:function(e){this.sendRequest("/api/demographics/"+e,"GET",e,null,function(e){e&&(e.error?$("#profileLocaleTimezoneContainer .get-locale-error").html(i18next.t("Server error occurred retrieving locale information.")):e.communication&&$("#profileLocaleTimezoneContainer .get-locale-error").html(""))})},hasTreatment:function(e){if(!e||!e.entry||0===e.entry.length)return!1;var t=e.entry.sort(function(e,t){return new Date(t.resource.meta.lastUpdated)-new Date(e.resource.meta.lastUpdated)}),r=!1;return t.forEach(function(e){if(r)return!0;var t=String(e.resource.code.coding[0].code),n=String(e.resource.code.coding[0].system),i=e.resource.id;(t===a.a.CANCER_TREATMENT_CODE&&n===a.a.SNOMED_SYS_URL||t===a.a.NONE_TREATMENT_CODE&&n===a.a.CLINICAL_SYS_URL)&&(r={code:t,id:i})}),r},getTreatment:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/patient/"+e+"/procedure","GET",e,t,function(e){e.error&&$("#userProcedures").html("<span class='error-message'>"+i18next.t("Error retrieving data from server")+"</span>"),r(e)})},postTreatment:function(e,t,r,n){if(!e)return!1;this.deleteTreatment(e,n);var i=a.a.NONE_TREATMENT_CODE,o="None",s=a.a.CLINICAL_SYS_URL;if(t&&(i=a.a.CANCER_TREATMENT_CODE,o="Procedure on prostate",s=a.a.SNOMED_SYS_URL),!r){var c=new Date;r=c.getFullYear()+"-"+(c.getMonth()+1)+"-"+c.getDate()}var u=[{code:i,display:o,system:s}],d={resourceType:"Procedure"};d.subject={reference:"Patient/"+e},d.code={coding:u},d.performedDateTime=r||"",this.postProc(e,d,n)},deleteTreatment:function(e,t){var r=this;this.sendRequest("/api/patient/"+e+"/procedure","GET",e,{sync:!0},function(e){if(!e||e.error)return!1;var n=r.hasTreatment(e);return!!n&&(String(n.code)===String(a.a.CANCER_TREATMENT_CODE)?(r.deleteProc(n.id,t,!0),!0):void r.deleteProc(n.id,t,!0))})},getProc:function(e,t,r){r=r||function(){},this.sendRequest("/api/patient/"+e+"/procedure","GET",e,null,function(e){r(e)})},postProc:function(e,t,r,n){n=n||function(){},this.sendRequest("/api/procedure","POST",e,{data:JSON.stringify(t),targetField:r},function(e){if(!e)return n({error:i18next.t("no data returned")}),!1;if(e.error){var t=i18next.t("Server error occurred saving procedure/treatment information.");return $("#userProcuedures .get-procs-error").html(t),n({error:t}),!1}$(".get-procs-error").html(""),n(e)})},deleteProc:function(e,t,r){this.sendRequest("/api/procedure/"+e,"DELETE",null,{sync:r,targetField:t},function(e){e.error?$(".del-procs-error").html(i18next.t("Server error occurred removing procedure/treatment information.")):$(".del-procs-error").html("")})},getRoleList:function(e,t){this.sendRequest("/api/roles","GET",null,e,function(e){if(t=t||function(){},e.error){var r=i18next.t("Server error occurred retrieving roles information.");$(".get-roles-error").html(r),t({error:r})}else t(e)})},getRoles:function(e,t,r){t=t||function(){};var n="userRole_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));t(i)}else this.sendRequest("/api/user/"+e+"/roles","GET",e,r,function(e){if(e)if(e.error){var r=i18next.t("Server error occurred retrieving user role information.");$(".get-roles-error").html(r),t({error:r})}else $(".get-roles-error").html(""),sessionStorage.setItem(n,JSON.stringify(e)),t(e)})},removeCachedRoles:function(e){sessionStorage.removeItem("userRole_"+e)},putRoles:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("User Id is required.")}),!1;this.removeCachedRoles(e),this.sendRequest("/api/user/"+e+"/roles","PUT",e,{data:JSON.stringify(t),targetField:r},function(t){if(!t||t.error){var r=i18next.t("Server error occurred setting user role information.");return $(".put-roles-error").html(r),void n({error:r})}$(".put-roles-error").html(""),sessionStorage.setItem("userRole_"+e,""),n(t)})},deleteRoles:function(e,t){if(!e)return!1;this.removeCachedRoles(e),this.sendRequest("/api/user/"+e,"GET",e,{data:JSON.stringify(t)},function(e){e&&(e.error?$(".delete-roles-error").html(i18next.t("Server error occurred deleting user role.")):$(".delete-roles-error").html(""))})},getClinical:function(e,t,r){r=r||function(){},this.sendRequest("/api/patient/"+e+"/clinical","GET",e,t,function(e){if(e)if(e.error){var t=i18next.t("Server error occurred retrieving clinical data.");$(".get-clinical-error").html(t),r({error:t})}else $(".get-clinical-error").html(""),r(e)})},getObservationId:function(e,t){if(!e)return!1;var r="",n="";return this.sendRequest("/api/patient/"+e+"/clinical","GET",e,{sync:!0},function(e){if(!e||e.error||!e.entry)return r;e.entry.forEach(function(e){r||(n=e.content.code.coding[0].code,String(n)===String(t)&&(r=e.content.id))})}),r},postClinical:function(e,t,r,n,i,s,c){if(!e)return!1;s=s||{};var u="",d="";if(o.hasOwnProperty(String(t).toLowerCase())){var l=o[t];u=l.code,d=l.display}if(!u)return!1;var f="POST",p="/api/patient/"+e+"/clinical",h=[{code:u,display:d,system:a.a.CLINICAL_SYS_URL}],g={resourceType:"Observation"};g.code={coding:h},g.issued=s.issuedDate?s.issuedDate:"",g.status=n||"",g.valueQuantity={units:"boolean",value:r},s.performer&&(g.performer=s.performer);var m=this.getObservationId(e,u);m&&(f="PUT",p=p+"/"+m),c=c||function(){},this.sendRequest(p,f,e,{data:JSON.stringify(g),targetField:i},function(e){if(!e||e.error){var t=i18next.t("Server error occurred updating clinical data.");return $(".post-clinical-error").html(t).show(),void c({error:t})}$(".post-clinical-error").html("").hide(),c(e)})},getTermsUrl:function(e,t){t=t||function(){},this.sendRequest("/api/tou","GET",null,{sync:e},function(e){e&&(e.error?($(".get-tou-error").html(i18next.t("Server error occurred retrieving tou url.")),t({error:i18next.t("Server error")})):($(".get-tou-error").html(""),e.url?($("#termsURL").attr("data-url",e.url),$("#termsCheckbox_default .terms-url").attr("href",e.url),t({url:e.url})):t({error:i18next.t("no url returned")})))})},getInstrumentsList:function(e,t){t=t||function(){},this.sendRequest("api/questionnaire_bank","GET",null,{sync:e},function(e){if(e&&!e.error)if(e.entry&&e.entry.length){var r={};e.entry.forEach(function(e){if(e.organization){var t=e.organization.reference.split("/")[2];r[t]||(r[t]=[]),e.questionnaires&&e.questionnaires.forEach(function(e){-1===$.inArray(e.questionnaire.display,r[t])&&r[t].push(e.questionnaire.display)})}}),t(r)}else t({error:i18next.t("no data returned")});else t({error:i18next.t("error retrieving instruments list")})})},getTerms:function(e,t,r,n,i){n=n||function(){},i=i||{};var a="/api/user/{userId}/tou{type}{all}".replace("{userId}",e).replace("{type}",t?"/"+t:"").replace("{all}",i.hasOwnProperty("all")?"?all=true":"");this.sendRequest(a,"GET",e,{sync:r},function(e){if(!e||e.error){var t=i18next.t("Server error occurred retrieving tou data.");return $(".get-tou-error").html(t),void n({error:t})}$(".get-tou-error").html(""),n(e)})},postTermsByUser:function(e,t,r){r=r||function(){},this.sendRequest("/api/user/"+e+"/tou/accepted","POST",e,{data:JSON.stringify(t)},function(e){if(!e||e.error)return $(".post-tou-error").html(i18next.t("Server error occurred saving terms of use information.")),void r(e);$(".post-tou-error").html(""),r(e)})},postTerms:function(e,t,r){r=r||function(){},this.sendRequest("/api/tou/accepted","POST",null,{data:JSON.stringify(e),targetField:t},function(e){if(!e||e.error){var t=i18next.t("Server error occurred saving terms of use information.");return $(".post-tou-error").html(t),void r({error:t})}$(".post-tou-error").html(""),r(e)})},accessUrl:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/access_url","GET",e,{sync:t},function(e){e?e.error?r({error:i18next.t("Error occurred retrieving access url.")}):r({url:e.access_url}):r({error:i18next.t("no data returned")})})},invite:function(e,t,r){if(r=r||function(){},!t)return r({error:i18next.t("Invite data are required.")}),!1;this.sendRequest("/invite","POST",e,{contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:t,dataType:"html"},function(e){r(e||{error:i18next.t("no data returned")})})},passwordReset:function(e,t){if(t=t||function(){},!e)return t({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/password_reset","POST",e,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"},function(e){e?e.error?t({error:i18next.t("Error occurred sending password reset request.")}):t(e):t({error:i18next.t("no data returned")})})},assessmentStatus:function(e,t){if(t=t||function(){},!e)return t({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment-status","GET",e,null,function(e){e?e.error?t({error:i18next.t("Error occurred retrieving assessment status.")}):t(e):t({error:i18next.t("no data returned")})})},updateAssessment:function(e,t,r){return r=r||function(){},e?t?void this.sendRequest("/api/patient/"+e+"/assessment","PUT",e,{data:JSON.stringify(t)},function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment list.")}):r(e):r({error:i18next.t("no data returned")})}):(r({error:i18next.t("Questionnaire response data is required.")}),!1):(r({error:i18next.t("User id is required.")}),!1)},assessmentList:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment list.")}):r(e):r({error:i18next.t("no data returned")})})},assessmentReport:function(e,t,r){if(r=r||function(){},!e||!t)return r({error:i18next.t("User id and instrument Id are required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment/"+t,"GET",e,null,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment report.")}):r(e):r({error:i18next.t("no data returned")})})},getCurrentQB:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("User id is required.")}),!1;r=r||{},this.sendRequest("/api/user/"+e+"/questionnaire_bank","GET",e,{data:{as_of_date:t},sync:r.sync},function(e){if(!e||e.error)return n({error:i18next.t("Error occurred retrieving current questionnaire bank for user.")}),!1;n(e)})},patientReport:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/user_documents?document_type=PatientReport","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving patient report.")}):r(e):r({error:i18next.t("no data returned")})})},setTablePreference:function(e,t,r,n){if(n=n||function(){},r=r||{},!e||!t)return n({error:"User Id and table name is required for setting preference."}),!1;this.sendRequest("/api/user/"+e+"/table_preferences/"+t,"PUT",e,{data:r.data,sync:r.sync},function(e){if(!e||e.error)return n({error:i18next.t("Error occurred setting table preference.")}),!1;n(e)})},getTablePreference:function(e,t,r,n){if(r=r||function(){},n=n||function(){},!e)return n({error:"User Id is required for setting preference."}),!1;this.sendRequest("/api/user/"+e+"/table_preferences/"+t,"GET",e,r,function(e){e&&e.error?n({error:i18next.t("Error occurred setting table preference.")}):n(e)})},emailLog:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/messages","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving email audit entries.")}):r(e):r({error:i18next.t("no data returned")})})},auditLog:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/audit","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving audit log.")}):r(e):r({error:i18next.t("no data returned")})})},setting:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("configuration key is required.")}),!1;r=r||{},this.sendRequest("/api/settings/"+e,"GET",t,{sync:r.sync},function(e){e?e.error?n({error:i18next.t("Error occurred retrieving content for configuration key.")}):n(e):n({error:i18next.t("no data returned")})})},deactivateUser:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/user/"+e,"DELETE",e,t||{},function(e){r=r||function(){},e&&!e.error?r(e):r({error:i18next.t("Error occurred deactivating user.")})})},reactivateUser:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/user/"+e+"/reactivate","POST",e,t||{},function(e){e&&!e.error?r(e):r({error:i18next.t("Error occurred reactivating user.")})})},getConfigurationByKey:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("configuration variable name is required.")}),!1;var n="config_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));return r(i),!0}this.sendRequest("/api/settings/"+e,"GET",null,t||{},function(e){e?(r(e),sessionStorage.setItem(n,JSON.stringify(e))):r({error:i18next.t("no data returned")})})},getConfiguration:function(e,t,r){r=r||function(){};var n="settings_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));r(i)}else this.sendRequest("/api/settings","GET",e,t||{},function(e){e?(r(e),sessionStorage.setItem(n,JSON.stringify(e))):r({error:i18next.t("no data returned")})})},getEmailReady:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/email_ready","GET",e,t,function(e){r(e)})}}},function(e,t,r){"use strict";var n,i,a=r(0),o=r(3);t.a=(n=function(e,t,r){this.id=e,this.name=t,this.children=[],this.parentOrgId=r,this.isTopLevel=!1,this.language=null,this.extension=[]},(i=function(){this.TOP_LEVEL_ORGS=[],this.orgsList={},this.initialized=!1}).prototype.init=function(e){var t=this;if(e=e||function(){},sessionStorage.orgsData){var r=JSON.parse(sessionStorage.orgsData);t.populateOrgsList(r),e(r)}else $.ajax({type:"GET",url:"/api/organization",async:!1}).done(function(r){r&&r.entry&&(t.populateOrgsList(r.entry),sessionStorage.setItem("orgsData",JSON.stringify(r.entry)),e(r.entry))}).fail(function(t){e({error:t.responseText}),o.a.sendError(t,"/api/organization")})},i.prototype.onLoaded=function(e,t){e&&this.setUserId(e),t&&this.populateUI(),$("#userOrgs input[name='organization']").each(function(){$(this).prop("checked",!1)}),$("#clinics").attr("loaded",!0)},i.prototype.setUserId=function(e){$("#fillOrgs").attr("userId",e)},i.prototype.getUserId=function(){return $("#fillOrgs").attr("userId")},i.prototype.inArray=function(e,t){if(!e||!t||!Array.isArray(t))return!1;for(var r=!1,n=0;!r&&n<t.length;n++)r=String(t[n])===String(e);return r},i.prototype.getElementParentOrg=function(e){var t;return!!e&&((t=$(e).attr("data-parent-id"))||(t=$(e).closest(".org-container[data-parent-id]").attr("data-parent-id")),t)},i.prototype.getTopLevelOrgs=function(){var e=this.getOrgsList(),t=[];for(var r in e)e[r].isTopLevel&&t.push(r);return t},i.prototype.getOrgsList=function(){return this.orgsList},i.prototype.getOrgName=function(e){var t=this.getOrgsList();return e&&t.hasOwnProperty(e)?t[e].name:""},i.prototype.filterOrgs=function(e){if(0===(e=e||[]).length)return!1;var t=this;$("#fillOrgs input[name='organization']").each(function(){if(!t.inArray($(this).val(),e)&&($(this).hide(),t.orgsList[$(this).val()])){var r=$(this).closest("label");0===t.orgsList[$(this).val()].children.length?r.hide():r.addClass("data-display-only")}}),t.getTopLevelOrgs().forEach(function(e){var t=!0;$("#fillOrgs .org-container[data-parent-id='"+e+"']").each(function(){var e=$(this).find(".org-container");if(e.length>0){var r=!0;e.each(function(){var e=!1;$(this).find("input[name='organization']").each(function(){($(this).is(":visible")||"none"!==String($(this).css("display")))&&(e=!0,t=!1)}),e?r=!1:$(this).hide()}),r&&$(this).children("label").hide()}else{var n=$(this).find("input[name='organization']");n.length>0&&n.each(function(){($(this).is(":visible")||"none"!==String($(this).css("display")))&&(t=!1)})}}),t&&$("#fillOrgs").find("legend[orgid='"+e+"']").hide()})},i.prototype.findOrg=function(e,t){var r;return!(!e||!t)&&(e.forEach(function(e){r||parseInt(e.id)===parseInt(t)&&(r=e)}),r)},i.prototype.getOrgName=function(e){var t=this.orgsList[e];return t?t.name:""},i.prototype.populateOrgsList=function(e){if(Object.keys(this.orgsList).length>0)return this.orgsList;var t,r=e,i=this,o={};return!!e&&(e.forEach(function(e){if(e.partOf){if(t=e.partOf.reference.split("/").pop(),!o[t]){var s=i.findOrg(r,t);o[t]=new n(s.id,s.name)}o[t].children.push(new n(e.id,e.name,t)),o[e.id]?o[e.id].parentOrgId=t:o[e.id]=new n(e.id,e.name,t)}else o[e.id]||(o[e.id]=new n(e.id,e.name)),0!==parseInt(e.id)&&(o[e.id].isTopLevel=!0,i.TOP_LEVEL_ORGS.push(e.id));e.extension&&(o[e.id].extension=e.extension),e.language&&(o[e.id].language=e.language),e.identifier&&(o[e.id].identifier=e.identifier,e.identifier.forEach(function(t){t.system===a.a.shortname&&(o[e.id].shortname=t.value)}))}),e.forEach(function(e){e.partOf&&(t=e.partOf.reference.split("/").pop(),o[e.id]&&(o[e.id].parentOrgId=t))}),e.length>0&&(this.initialized=!0),this.orgsList=o,o)},i.prototype.getShortName=function(e){var t="";if(!e)return t;var r=this.getOrgsList(),n=r.hasOwnProperty(e)?r[e]:{};return n.shortname&&(t=n.shortname),t},i.prototype.populateUI=function(){if(sessionStorage.orgsHTML)return $("#fillOrgs").html(sessionStorage.orgsHTML),!0;var e=this,t=$("#fillOrgs"),r=this.orgsList,n="",i=function(e){if(!e.identifier)return"";var t="",r=!1;return e.identifier.forEach(function(e){!r&&e.system===a.a.practice_region&&e.value&&(t=e.value.split(":")[1],r=!0)}),t},o=Object.keys(r),s=[];(o=o.sort()).forEach(function(e){r[e].isTopLevel&&s.push(e)}),s=s.sort(function(e,t){var n=r[e],i=r[t];return n.name<i.name?-1:n.name>i.name?1:0});var c,u=document.createDocumentFragment();s.forEach(function(e){(c=document.createElement("div")).setAttribute("id",e+"_container");var t=r[e],a=t.shortname||t.name,o=i(t),s=t.name;t.children.length?0===$("#userOrgs legend[orgId='"+e+"']").length&&(c.classList.add("parent-org-container"),n='<legend orgId="'.concat(e,'">').concat(s,'</legend>\n                        <input class="tnth-hide" type="checkbox" name="organization" parent_org="true" data-org-name="').concat(s,'" data-short-name="').concat(a,'" id="').concat(e,'_org" state="').concat(o,'" value="').concat(e,'" /></div>')):0===$("#userOrgs label[id='org-label-"+e+"']").length&&(c.classList.add("parent-org-container","parent-singleton"),n='<label id="org-label-'.concat(e,'" class="org-label">\n                        <input class="clinic" type="checkbox" name="organization" parent_org="true" id="').concat(e,'_org" state="').concat(o,'" value="').concat(e,'"\n                        data-parent-id="').concat(e,'"  data-org-name="').concat(s,'" data-short-name="').concat(a,'" data-parent-name="').concat(s,'"/><span>').concat(s,"</span></label></div>")),c.innerHTML=n,u.appendChild(c)}),t.get(0).appendChild(u),o.forEach(function(n){if(r[n].children.length>0){var a="";r[n].children.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0}).forEach(function(n){var o=n.parentOrgId,s=r[o],c=!!s&&s.isTopLevel,u=i(r[o]),d=e.getTopLevelParentOrg(n.id);if($("#fillOrgs input[name='organization'][value='"+n.id+"']").length>0)return!0;var l={dataAttributes:' data-parent-id="'+d+'"  data-parent-name="'+r[d].name+'" ',containerClass:"",textClass:""};c&&(l.dataAttributes=' data-parent-id="'+o+'"  data-parent-name="'+s.name+'" '),r[n.id].children.length>0?c?(l.containerClass="sub-org-container",l.textClass="text-muted"):l.textClass="text-muter":c&&(l.textClass="text-muted singleton"),a='<div id="'.concat(n.id,'_container" ').concat(l.dataAttributes,' class="indent org-container ').concat(l.containerClass,'">\n                        <label id="org-label-').concat(n.id,'" class="org-label ').concat(l.textClass,'">\n                        <input class="clinic" type="checkbox" name="organization" id="').concat(n.id,'_org" data-org-name="').concat(n.name,'" data-short-name="').concat(n.shortname||n.name,'" state="').concat(u||"",'" value="').concat(n.id,'" ').concat(l.dataAttributes," />\n                        <span>").concat(n.name,"</span></label></div>");var f=$("#"+o+"_container");f.length>0?f.append(a):t.append(a)})}}),sessionStorage.setItem("orgsHTML",t.html()),t.text()||t.html(i18next.t("No organizations available"))},i.prototype.getSelectedOrgTopLevelParentOrg=function(){return this.getTopLevelParentOrg(this.getSelectedOrg().val())},i.prototype.getSelectedOrg=function(){return $("#userOrgs input[name='organization']:checked")},i.prototype.getUserTopLevelParentOrgs=function(e){var t=[],r=this;return!!e&&(e.parentList?e.parentList:(e.forEach(function(e){var n=r.getTopLevelParentOrg(e);n&&!r.inArray(n,t)&&t.push(n)}),e.parentList=t,t))},i.prototype.getTopLevelParentOrg=function(e){var t=this.getOrgsList()[e];return!!t&&(t.isTopLevel?e:t.parentOrgId?this.getTopLevelParentOrg(t.parentOrgId):e)},i.prototype.getChildOrgs=function(e,t){if(t=t||[],!e||!e.length)return t;var r=this.getOrgsList(),n=[];return e.forEach(function(e){var i=r[e.id];if(!i)return!0;t.push(e.id);var a=i.children?i.children:null;a&&a.length&&a.forEach(function(e){n.push(e)})}),this.getChildOrgs(n,t)},i.prototype.getHereBelowOrgs=function(e){var t=this.getOrgsList(),r=this,n=[];if(!e){var i=this.getSelectedOrg();i.length>0&&(e=[],i.each(function(){e.push($(this).val())}))}return(e=e||[]).forEach(function(e){n.push(e);var i=t[e],a=r.getChildOrgs(i&&i.children?i.children:[]);a.length&&(n=n.concat(a))}),n},i.prototype.morphPatientOrgs=function(){var e={};$("#userOrgs input[name='organization']").each(function(){$(this).closest("label").addClass("radio-label"),$(this).prop("checked")&&(e[$(this).val()]=!0),$(this).attr("type","radio"),e[$(this).val()]&&$(this).prop("checked",!0)}),$("#userOrgs .noOrg-container").hide()},i)},,function(e,t,r){"use strict";var n=r(3),i=r(2),a=r(1),o=r(0);t.a={subjectId:"",currentUserId:"",dateFields:["procDay","procMonth","procYear"],entries:[],initCounts:0,init:function(e){var t=this;this.initUserIds(e,function(){if(!t.subjectId)return t.setError(i18next.t("Subject id is required")),!1;t.getOptions(),t.getUserProcedures(),t.initFieldExtension(),t.initFieldEvents()})},initViaTemplate:function(){var e=this;$(document).ready(function(){var t=$("#profileProcSubjectId");t.length&&e.init(t.val())})},initUserIds:function(e,t){t=t||function(){};var r=this;this.setSubjectId(e),n.a.getCurrentUser(function(e){if(!e||e.error)return r.setError(i18next.t("error occurred setting current user id")),void t();r.setCurrentUserId(e.id),r.subjectId||r.setSubjectId(e.id),t()})},setSubjectId:function(e){this.subjectId=e},setCurrentUserId:function(e){this.currentUserId=e},setError:function(e){$("#procDateErrorContainer").html(e||""),e&&$("#procedure_view").html("<p class='text-muted'>"+i18next.t("no data found")+"</p>")},setTreatmentOptionsSelector:function(e){if(e){var t=[];t.push("<option value=''>"+i18next.t("Select")+"</option>"),e.forEach(function(e){t.push("<option value='{value}' data-system='{system}'>{text}</option>".replace("{value}",e.code).replace("{text}",e.text).replace("{system}",e.system))}),$("#tnthproc").append(t.join("")),sessionStorage.setItem("treatmentOptions",JSON.stringify(e))}},getOptions:function(){if($("#tnthproc").length)if(sessionStorage.treatmentOptions)this.setTreatmentOptionsSelector(JSON.parse(sessionStorage.treatmentOptions));else{var e=this,t="/patients/treatment-options";if(window.Worker)return a.a.initWorker(t,{cache:!0},function(t){var r=JSON.parse(t);e.setTreatmentOptionsSelector(r.treatment_options)}),!0;$.ajax({type:"GET",url:t,cache:!0}).done(function(t){e.setTreatmentOptionsSelector(t.treatment_options)}).fail(function(){})}},getCreatorDisplay:function(e,t){return e?String(e)===this.currentUserId?i18next.t("you"):String(e)===String(this.subjectId)?i18next.t("this patient"):i18next.t("staff member")+", <span class='creator'>"+t+"</span>, ":""},getDeleteInvocationDisplay:function(){return $("#popoverHolder .popover__link").html()},setNewEntry:function(e,t){e&&$("#eventListtnthproc").find("tr[data-id='"+t+"'] td.descriptionCell").append("&nbsp; <small class='text-success'><i class='fa fa-check-square-o'></i> <em>"+i18next.t("Added!")+"</em></small>")},setProcedureRowsView:function(){var e="";$("#userProcedures tr[data-id]").each(function(){$(this).find("td").each(function(){$(this).hasClass("list-cell")||$(this).hasClass("lastCell")||(e+="<div>"+$(this).text()+"</div>")})}),$("#procedure_view").html(e||"<p class='text-muted'>"+i18next.t("no data found")+"</p>")},setNoDataDisplay:function(){$("#userProcedures").html("<p id='noEvents'><em>"+i18next.t("You haven't entered any management option yet.")+"</em></p>").animate({opacity:1}),$("#procedure_view").html("<p class='text-muted'>"+i18next.t("no data found")+"</p>"),$("#pastTreatmentsContainer").hide(),$("#eventListLoad").fadeOut()},getUserProcedures:function(e){if(!this.subjectId)return!1;var t=this;$.ajax({type:"GET",url:"/api/patient/"+this.subjectId+"/procedure",cache:!1}).done(function(r){if(0===r.entry.length)return t.setNoDataDisplay(),!1;t.onDidGetProcedures(r.entry,e),$("#eventListLoad").fadeOut()}).fail(function(){t.setError(i18next.t("error occurred retrieving user procedures")),$("#eventListLoad").fadeOut()})},initFieldEvents:function(){var e=this;this.convertToNumericField($("#procYear, #procDay")),setTimeout(function(){$("#tnthproc-submit").eventInput()},150),$("#tnthproc").on("change",function(){$("#tnthproc-submit").attr({"data-name":$(this).val(),"data-system":$(this).find("option:selected").attr("data-system")}),e.checkSubmit("#tnthproc-submit")}),e.dateFields.forEach(function(t){$("#"+t).on("keyup change",function(){e.setDate()})}),$("body").on("click",".data-delete",function(){$(this).closest("tr").remove()})},initPopoverEvents:function(){var e=this;$("[data-toggle='popover']").popover({trigger:"click",placement:"top",html:!0,content:$("#popoverHolder .popover__content").html()}),$("body").on("click",".cancel-delete",function(){$(this).parents("div.popover").prev("a.confirm-delete").trigger("click")}),$("body").on("click",".btn-delete",function(){var t=$(this).parents("tr").attr("data-id");return $(this).parents("tr").fadeOut("slow",function(){$(this).remove(),0===$("#eventListtnthproc tr").length&&e.setNoDataDisplay()}),n.a.deleteProc(t,!1,!1,function(){e.getUserProcedures()}),!1})},onDidGetProcedures:function(e,t){this.populateProcedureRows(e,t),this.setProcedureRowsView(),this.setError(!e||e.error?i18next("Error occurred retrieving procedures"):"")},populateProcedureRows:function(e,t){e.sort(function(e,t){return new Date(t.resource.performedDateTime)-new Date(e.resource.performedDateTime)});var r=this,n=[],a="",s=[],c=0;$.each(e,function(e,t){var a=t.resource.code.coding[0].code,u=t.resource.id;if(-1!==[o.a.CANCER_TREATMENT_CODE,o.a.NONE_TREATMENT_CODE].indexOf(a))return s.push("<input type='hidden' data-id='"+u+"'  data-code='"+a+"' name='otherProcedures' >"),!0;var d=t.resource.meta.by.reference.match(/\d+/)[0],l=r.getCreatorDisplay(d,t.resource.meta.by.display||d),f=new Date(t.resource.meta.lastUpdated),p=i18next.t("(data entered by %actor on %date)").replace("%actor",l).replace("%date",f.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})),h="";String(d)===String(r.currentUserId)&&(h=r.getDeleteInvocationDisplay()),n.push(["<tr data-id='"+u+"' data-code='"+a+"'>","<td width='1%' valign='top' class='list-cell'>&#9679;</td>","<td class='col-md-10 col-xs-10 descriptionCell' valign='top'>"+i.a.formatDateString(t.resource.performedDateTime)+"&nbsp;--&nbsp;"+t.resource.code.coding[0].display+"&nbsp;<em>"+p+"</em></td>","<td class='col-md-2 col-xs-2 lastCell text-left' valign='top'>"+h+"</td>","</tr>"].join("")),c=Math.max(c,u)}),n&&(a='<table  class="table-responsive" width="100%" id="eventListtnthproc" cellspacing="4" cellpadding="6">',a+=n.join(""),a+="</table>",$("#userProcedures").html(a)),this.setNewEntry(t,c),this.initPopoverEvents(),$("#eventListtnthproc tr").length?$("#pastTreatmentsContainer").fadeIn():$("#pastTreatmentsContainer").fadeOut(),$("#userProcedures").append(s.join(""))},handleOtherProcedures:function(){var e=$("#userProcedures input[name='otherProcedures']");if(!e.length)return!1;e.each(function(){var e=$(this).attr("data-code"),t=$(this).attr("data-id");-1!==[o.a.CANCER_TREATMENT_CODE,o.a.NONE_TREATMENT_CODE].indexOf(e)&&n.a.deleteProc(t)})},setAccountCreationRowDisplay:function(e){if(e=e||{},0===$("#pastTreatmentsContainer tr[data-code='"+e.code+"'][data-performedDateTime='"+e.performedDateTime+"']").length){var t=[];t.push("<tr ");var r=[];for(var n in e)r.push("data-"+n+"='"+e[n]+"'");t.push(r.join(" ")),t.push(">"),t.push("<td>&#9679;</td><td>"+e.display+"</td><td>"+e.performedDateTime+"</td><td><a class='btn btn-default btn-xs data-delete'>"+i18next.t("REMOVE")+"</a></td>"),t.push("</tr>"),$("#pastTreatmentsContainer").append(t.join("")),setTimeout(function(){$("#pastTreatmentsContainer").show()},100)}},initFieldExtension:function(){var e=this;$.fn.extend({eventInput:function(){$(this).on("click",function(t){t.stopImmediatePropagation(),$(this).attr("disabled",!0);var r=$(this).attr("data-account-create"),i=e.subjectId,a=$(this).attr("data-name"),o=$(this).attr("data-date"),s=$(this).attr("data-system");if(!a||!o)return!1;var c=$("#tnthproc option:selected").text(),u={resourceType:"Procedure",performedDateTime:o,system:s};if(r)u.display=c,u.code=a,e.setAccountCreationRowDisplay(u);else{e.handleOtherProcedures();var d=[{code:a,display:c,system:s}];u.subject={reference:"Patient/"+i},u.code={coding:d},n.a.postProc(i,u),$("#eventListLoad").show(),setTimeout(function(){e.getUserProcedures(!0)},1800),$("#pastTreatmentsContainer").hide()}return e.reset(),!1})}})},reset:function(){$("#tnthproc").val(""),$("#procDay, #procMonth, #procYear").val(""),$("#tnthproc-submit").addClass("disabled").attr({"data-name":"","data-date":"","data-date-read":"","data-system":""})},checkSubmit:function(e){""!==String($(e).attr("data-name"))&&""!==String($(e).attr("data-date-read"))?$(e).removeClass("disabled").removeAttr("disabled"):$(e).addClass("disabled").attr("disabled",!0)},convertToNumericField:function(e){("ontouchstart"in window||void 0!==window.DocumentTouch&&document instanceof window.DocumentTouch)&&$(e).each(function(){$(this).prop("type","tel")})},isTouchScreen:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch},checkDate:function(){var e=$("#procDay"),t=$("#procMonth"),r=$("#procYear"),n=e.val(),a=r.val(),o=$("#procDateErrorContainer");return!(!n||!/(19|20)\d{2}/.test(a)||(i.a.validateDateInputFields(t.val(),e.val(),r.val(),"procDateErrorContainer")?(o.text("").removeClass("error-message"),0):(o.text(i18next.t("The procedure date must be valid and in required format.")).addClass("error-message"),1)))},setDate:function(){if(this.checkDate()){var e=this.dateFields.map(function(e){return $("#"+e).val()}).join("/");$("#tnthproc-submit").attr("data-date-read",e),$("#tnthproc-submit").attr("data-date",i.a.swap_mm_dd(e))}else $("#tnthproc-submit").attr({"data-date-read":"","data-date":""});this.checkSubmit("#tnthproc-submit")}}},,,,,,,,,,function(e,t,r){"use strict";r.r(t);var n,i=r(1),a=r(2),o=r(3),s=r(0),c=r(4),u=r(6);n=window.AccountCreationObj=function(e,t){function r(e){var t=$(e).attr("data-parent-id");return t||(t=$(e).closest(".org-container[data-parent-id]").attr("data-parent-id")),t}this.attempts=0,this.maxAttempts=3,this.params=null,this.roles=e,this.userId="None created",this.dependencies=t||{},this.treatmentIntervalVar=null,this.CONSENT_WITH_TOP_LEVEL_ORG=!1,$.ajaxSetup({timeout:5e3,retryAfter:3e3}),this.__getDependency=function(e){return!(!e||!this.dependencies.hasOwnProperty(e))&&this.dependencies[e]};var n=this.__getDependency("i18next"),u=new c.a,d=this.__getDependency("leafOrgs"),l=this.__getDependency("orgList");this.__isPatient=function(){return"patient"===$("#accountCreationContentContainer").attr("data-account")},this.__request=function(e){(e=e||{}).callback=e.callback||function(){};var t=this;if(!e.apiUrl)return e.callback.call(t,{error:"API url is required."}),!1;return t.attempts++,t.params=e,$.ajax({type:e.requestType?e.requestType:"GET",url:String(e.apiUrl).replace("//","/"),contentType:"application/json; charset=utf-8",dataType:"json",async:!e.sync,data:e.requestData}).done(function(r){t.attempts=0,e.callback.call(t,{data:r})}).fail(function(r){if(t.attempts<t.maxAttempts)setTimeout(function(){t.__request(t.params)},$.ajaxSetup().retryAfter);else{t.attempts=0;var i=n.t("Server error occurred updating data.");$("#error_response_text").html(i),e.callback.call(t,{error:i}),o.a.sendError(r,e.apiUrl,t.userId)}}),""},this.__setAccount=function(){var e=$("#userOrgs input:checked").map(function(){return{organization_id:$(this).val()}}).get(),t={};t.organizations=e,this.roles&&(t.roles=this.roles,$("#rolesContainer .input-role").each(function(){$(this).is(":checked")&&(t.roles=t.roles.concat([{name:$(this).attr("data-role")}]))})),t.consents=this.getConsents(),this.__request({apiUrl:"/api/account",requestType:"POST",requestData:JSON.stringify(t),sync:!0,callback:this.__setDemo})},this.__setDemo=function(e){var t=e&&e.data?e.data:null,r=this;if(!t||e.error)return this.__handleError(e.error),this.__handleButton(),!1;if(r.userId=t.user_id,isNaN(r.userId))return r.__handleError(n.t("Invalid user id: %d").replace("%d",r.userId)),r.__handleButton(),!1;var i={resourceType:"Patient"};i.name={given:$.trim($("input[name=firstname]").val()),family:$.trim($("input[name=lastname]").val())};var a=$("#year").val(),o=$("#month").val(),c=$("#date").val();a&&o&&c&&(i.birthDate=a+"-"+o+"-"+c),i.telecom=[];var u=$.trim($("input[name=email]").val());u?i.telecom.push({system:"email",value:u}):i.telecom.push({system:"email",value:"__no_email__"}),i.telecom.push({system:"phone",use:"mobile",value:$.trim($("input[name=phone]").val())}),i.telecom.push({system:"phone",use:"home",value:$.trim($("input[name=altPhone]").val())});var d=$("#userOrgs input:checked").map(function(){return{reference:"api/organization/"+$(this).val()}}).get();i.careProvider=d;var l=r.getCommunicationArray();l.length>0&&(i.communication=l);var f=$("#profileStudyId").val();if(f){var p={system:s.a.external_study_id,use:"secondary",value:f};i.identifier||(i.identifier=[]),i.identifier.push(p)}var h=$("#profileSiteId").val();if(h){var g={system:s.a.external_site_id,use:"secondary",value:h};i.identifier||(i.identifier=[]),i.identifier.push(g)}r.__request({apiUrl:"/api/demographics/"+this.userId,requestType:"PUT",requestData:JSON.stringify(i),sync:!0,callback:function(e){if(e.error)return r.__handleError(e.error),void r.__handleButton();r.__setPcaLocalized(function(e){r.__setProcedures(function(e){if(!(e=e||{}).error)return r.__handleDisplay(),!0;r.__handleError(e.error+" "+n.t("Account created. Redirecting to profile...")),r.__handleButton(),function(e){setTimeout(function(){e.__redirect()},5e3)}(r)})})}})},this.__getSettings=function(e){e=e||function(){},this.__request({apiUrl:"/api/settings",requestType:"GET",callback:function(t){e(t)}})},this.__setPcaLocalized=function(e){if(e=e||function(){},!this.userId||!this.__isPatient())return e(),!1;var t=this.userId,r=u.getSelectedOrgTopLevelParentOrg();if(!r)return e(),!1;this.__getSettings(function(n){if(!n||!n.data.LOCALIZED_AFFILIATE_ORG)return e(),!1;o.a.postClinical(t,"pca_localized",u.getOrgName(r)===n.data.LOCALIZED_AFFILIATE_ORG,!1,!1,!1,function(t){e(t)})})},this.__setProcedures=function(e){var t=this;e=e||function(){};var r=$("#pastTreatmentsContainer tr[data-code]");if(0===r.length)return e(),t.__handleDisplay(),!1;if(isNaN(t.userId))return t.__handleError(n.t("Invalid user id: %d").replace("%d",t.userId)),t.__handleButton(),e(),!1;t.treatmentCount=r.length,t.counter=0;var i="";r.each(function(){var e={},r=[{code:$(this).attr("data-code"),display:$(this).attr("data-display"),system:$(this).attr("data-system")}];e.resourceType="Procedure",e.subject={reference:"Patient/"+t.userId},e.code={coding:r},e.performedDateTime=$(this).attr("data-performeddatetime"),function(t){setTimeout(function(){o.a.postProc(t.userId,e,!1,function(e){e.error&&(i=e.error),t.counter++})},100)}(t)}),t.treatmentIntervalVar=setInterval(function(){t.counter===t.treatmentCount&&(e({error:i}),clearInterval(t.treatmentIntervalVar))},100)},this.__handleDisplay=function(e){var t=e&&e.error?e.error:null,r=this;t?(r.__handleError(t),r.__handleButton()):(setTimeout(function(){r.__handleButton(),$("#confirmMsg").fadeIn()},800),setTimeout(function(){r.__redirect(r.userId)},1e3),setTimeout(function(){$("#confirmMsg").fadeOut()},1500),r.__clear())},this.__handleError=function(e){e&&$("#serviceErrorMsg").html("<small>"+n.t("[Processing error] ")+e+"</small>").fadeIn()},this.__redirect=function(){if(this.userId){var e=!1;this.roles&&this.roles.forEach(function(t){e||"patient"!==t.name.toLowerCase()||(e=!0)}),e?$("#redirectLink").attr("href","/patients/patient_profile/"+this.userId):$("#redirectLink").attr("href","/staff_profile/"+this.userId),$("#redirectLink")[0].click()}},this.__clear=function(){$("input.form-control, select.form-control").val(""),$("#pastTreatmentsContainer").html("")},this.__handleButton=function(e){"hide"===e?($("#updateProfile").attr("disabled",!0).hide(),$(".save-button-container").find(".loading-message-indicator").show()):($("#updateProfile").attr("disabled",!1).show(),$(".save-button-container").find(".loading-message-indicator").hide())},this.__checkFields=function(e){var t=!1;return $("input[required], select[required]").each(function(){$(this).val()||(e||$(this).trigger("focusout"),t=!0)}),$("#noEmail").length>0&&!$("#noEmail").is(":checked")&&($("#emailGroup").hasClass("has-error")?t=!0:$("#current_user_email").val()===$("#email").val()?(e||this.setHelpText("emailGroup",n.t("Email is already in use."),!0),t=!0):this.setHelpText("emailGroup","",!1)),$("#userOrgs input").length>0&&0===$("#userOrgs input:checked").length?(e||this.setHelpText("userOrgs",n.t("An organization must be selected."),!0),t=!0):this.setHelpText("userOrgs","",!1),$("#createProfileForm .help-block.with-errors").each(function(){""!==$(this).text()&&(t=!0)}),t?e||$("#errorMsg").fadeIn("slow"):($("#errorMsg").hide(),$("#serviceErrorMsg").html("").hide()),t},this.clearError=function(){this.__checkFields(!0)||$("#errorMsg").html("").hide()},this.setHelpText=function(e,t,r){r?$("#"+e).find(".help-block").text(t).addClass("error-message"):$("#"+e).find(".help-block").text("").removeClass("error-message")},this.getOrgs=function(e,t){var r=this;e=e||function(){},$("#clinicsLoader").removeClass("tnth-hide"),o.a.getOrgs(r.userId,t,function(t){return $("#clinicsLoader").addClass("tnth-hide"),t?t.error?(e.call(r,{error:n.t("Error occurred retrieving clinics data.")}),!1):void e.call(r,t):(e.call(r,{error:n.t("no data returned")}),!1)})},this.populateOrgsByRole=function(e){if(!e)return $("#userOrgs .get-orgs-error").html(n.t("No clinics data available.")),!1;if(e.error)return $("#userOrgs .get-orgs-error").html(e.error),!1;if(u.populateOrgsList(e.entry),u.populateUI(),!$("#userOrgs input[name='organization']").length)return $("#userOrgs .get-orgs-error").html(n.t("No clinics data available.")),!1;$.grep(this.roles,function(e){return"patient"===e.name}).length>0?this.populatePatientOrgs():this.populateStaffOrgs(),$("#userOrgs input[name='organization']").on("click",function(){$("#userOrgs").find(".help-block").html("")});var t=$("#userOrgs input[name='organization']:visible");1===t.length&&t.prop("checked",!0),this.handleMedidataRave()},this.populatePatientOrgs=function(){d&&u.filterOrgs(d),$("#userOrgs input[name='organization']").each(function(){$(this).closest("label").addClass("radio-label"),$(this).attr("type","radio")})},this.populateStaffOrgs=function(){l&&u.filterOrgs(l)},this.getCommunicationArray=function(){var e=[];return $("#userOrgs input:checked").each(function(){var t=u.getOrgsList()[$(this).val()];if(0===parseInt($(this).val())||!t)return!0;if(t.language)e.push({language:{coding:[{code:t.language,system:s.a.language_system}]}});else{t.extension=t.extension||[];var r=$.grep(t.extension,function(e){return String(e.url)===String(s.a.language)&&e.valueCodeableConcept.coding});(r=r.map(function(e){return e.valueCodeableConcept.coding})).forEach(function(t){e.push({language:{coding:t}})})}}),e},this.getCurrentUserTopLevelOrgs=function(){return u.getUserTopLevelParentOrgs(d).map(function(e){return u.getOrgName(e)})},this.handleMedidataRave=function(){var e=this;this.__getSettings(function(t){t.data.MEDIDATA_RAVE_ORG&&-1!==e.getCurrentUserTopLevelOrgs().indexOf(t.data.MEDIDATA_RAVE_ORG)&&e.setDisableAccountCreation()})},this.setDisableAccountCreation=function(){$("#accountCreationContentContainer[data-account='patient']").length>0&&$("#createProfileForm .create-account-container").append("<div class='overlay'></div>")},this.initFieldEvents=function(){["year","month","date"].forEach(function(e){$("#"+e).on("keyup focusout",function(){var e=$("#year").val(),t=$("#month").val(),r=$("#date").val();a.a.validateDateInputFields(t,r,e,"errorbirthday")?($("#birthday").val(e+"-"+t+"-"+r),$("#errorbirthday").html("")):$("#birthday").val("")})}),i.a.convertToNumericField($("#date, #year, #phone, #altPhone"))},this.initButtons=function(){var e=this;$("#createProfileForm .back-button-container").prepend(this.__getLoaderHTML()),$("#createProfileForm .save-button-container").prepend(this.__getLoaderHTML()),$("#createProfileForm .btn-tnth-back").on("click",function(e){e.preventDefault(),$(this).prev(".loading-message-indicator").show(),$(this).hide(),window.location=$(this).attr("href")}),$("#updateProfile").attr("disabled",!0),$("#createProfileForm input, #createProfileForm select").on("focusout",function(){$("#updateProfile").attr("disabled",!1),setTimeout(function(){e.clearError()},600)}),$("#createProfileForm").on("submit",function(t){return t.isDefaultPrevented()?(e.__checkFields(),!1):!e.__checkFields()&&(t.preventDefault(),e.__handleButton("hide"),void setTimeout(function(){e.__setAccount()},0))})},this.getConsentOrgId=function(e,t){var n=$(e).val();return t&&(n=r(e)),n},this.getConsentAgreementUrl=function(e){return $("#"+e+"_agreement_url").val()||$("#stock_consent_url").val()},this.getConsents=function(){var e={},t=[],n=!1,i=this;return o.a.setting("CONSENT_WITH_TOP_LEVEL_ORG","",{sync:!0},function(e){!e.error&&e.CONSENT_WITH_TOP_LEVEL_ORG&&(n=!0)}),$("#createProfileForm input[name='organization']").each(function(){if(!$(this).prop("checked"))return!0;var a=i.getConsentOrgId(this,n);if(!a||e.hasOwnProperty(a))return!1;e[a]=!0;var o=i.getConsentAgreementUrl(r(this));o=String(o).replace("placeholder",encodeURIComponent($(this).attr("data-parent-name")));var s=$("#consentDate").val();if(!o)return!0;var c={};s&&(c.acceptance_date=s),c.organization_id=a,c.agreement_url=o,c.staff_editable=!0,c.include_in_reports=!0,c.send_reminders=!0,t.push(c)}),t},this.handleEditConsentDate=function(){if(0!==$("#consentDateEditContainer").length){var e=new Date,t=function(e){return(e=parseInt(e))<10?"0"+e:e},r=t(e.getDate()),n=t(e.getMonth()+1),o=t(e.getFullYear()),s=e.getHours(),c=e.getMinutes(),u=e.getSeconds();$("#consentDay").val(r),$("#consentMonth").val(n),$("#consentYear").val(o),$("#consentDate").val(a.a.getDateWithTimeZone(a.a.getDateObj(o,n,r,s,c,u))),i.a.isTouchDevice()&&$("#consentDay, #consentYear").each(function(){$(this).attr("type","tel")}),$("#consentDay, #consentMonth, #consentYear").on("change",function(){var e=$("#consentDay"),r=$("#consentMonth"),n=$("#consentYear"),i=new Date,o=t(i.getDate()),s=t(i.getMonth()+1),c=t(i.getFullYear()),u=i.getHours(),d=i.getMinutes(),l=i.getSeconds();if(!n.get(0).validity.valid||!r.get(0).validity.valid||!e.get(0).validity.valid)return $("#consentDate").val(""),!1;a.a.validateDateInputFields(r.val(),e.val(),n.val(),"errorConsentDate")?(o+s+c===t(e.val())+t(r.val())+t(n.val())?$("#consentDate").val(a.a.getDateWithTimeZone(a.a.getDateObj(c,s,o,u,d,l))):$("#consentDate").val(a.a.getDateWithTimeZone(a.a.getDateObj(n.val(),r.val(),e.val(),12,0,0))),$("#errorConsentDate").text("").hide()):$("#consentDate").val("")})}},this.handleNoEmail=function(){$("#noEmail").on("click, change",function(){$(this).is(":checked")?($("#erroremail").css("visibility","hidden"),$("#email").val("").attr("disabled",!0).removeAttr("required").removeAttr("data-customemail"),setTimeout(function(){$("#erroremail").text(""),$("#email").closest("form-group").removeClass("has-error"),$("#email").css("border-color","#ccc")},600)):($("#erroremail").css("visibility","visible"),$("#email").attr("disabled",!1).attr("required","required").attr("data-customemail","true"))})},this.__getLoaderHTML=function(e){return'<div class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i>'.concat(e?"&nbsp;"+e:"","</div>")}},$(document).ready(function(){var e=[{name:"patient"},{name:"write_only"}];"staff"===$("#accountCreationContentContainer").attr("data-account")&&(e=[{name:"staff"},{name:"write_only"}]);var t=new n(e,{i18next:i18next,orgList:orgList,leafOrgs:leafOrgs});t.getOrgs(t.populateOrgsByRole),t.handleEditConsentDate(),t.initFieldEvents(),t.initButtons(),t.handleNoEmail(),u.a.initViaTemplate()})}]);
//# sourceMappingURL=../../maps/account.bundle.js.map