!function(e){var t={};function r(n){if(t[n])return t[n].exports;var i=t[n]={i:n,l:!1,exports:{}};return e[n].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(n,i,function(t){return e[t]}.bind(null,i));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=19)}({0:function(e,t,r){"use strict";t.a={external_study_id:"http://us.truenth.org/identity-codes/external-study-id",external_site_id:"http://us.truenth.org/identity-codes/external-site-id",practice_region:"http://us.truenth.org/identity-codes/practice-region",race:"http://hl7.org/fhir/StructureDefinition/us-core-race",race_system:"http://hl7.org/fhir/v3/Race",ethnicity:"http://hl7.org/fhir/StructureDefinition/us-core-ethnicity",ethnicity_system:"http://hl7.org/fhir/v3/Ethnicity",indigenous:"http://us.truenth.org/fhir/StructureDefinition/AU-NHHD-METeOR-id-291036",timezone:"http://hl7.org/fhir/StructureDefinition/user-timezone",language:"http://hl7.org/fhir/valueset/languages",language_system:"urn:ietf:bcp:47",shortname:"http://us.truenth.org/identity-codes/shortname",SNOMED_SYS_URL:"http://snomed.info/sct",CLINICAL_SYS_URL:"http://us.truenth.org/clinical-codes",CANCER_TREATMENT_CODE:"118877007",NONE_TREATMENT_CODE:"999"}},1:function(e,t,r){"use strict";r.d(t,"b",function(){return o}),r.d(t,"c",function(){return s});var n,i=((n=function(){this.requestAttempts=0}).prototype.hasValue=function(e){return"null"!==String(e)&&""!==String(e)&&"undefined"!==String(e)},n.prototype.showMain=function(){$("#mainHolder").css({visibility:"visible","-ms-filter":"progid:DXImageTransform.Microsoft.Alpha(Opacity=100)",filter:"alpha(opacity=100)","-moz-opacity":1,"-khtml-opacity":1,opacity:1})},n.prototype.hideLoader=function(e,t){e?$("#loadingIndicator").hide():setTimeout(function(){$("#loadingIndicator").fadeOut()},t||200)},n.prototype.loader=function(e){if(document.getElementById("fullSizeContainer"))return this.hideLoader(),this.showMain(),!1;if(e)$("#loadingIndicator").show();else if(!this.isDelayLoading()){var t=this;setTimeout(function(){t.showMain()},100),this.hideLoader(!0,350)}},n.prototype.isDelayLoading=function(){return"undefined"!=typeof DELAY_LOADING&&DELAY_LOADING},n.prototype.isTouchDevice=function(){return!0===("ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch)},n.prototype.getIEVersion=function(){var e=navigator.userAgent.match(/(?:MSIE |Trident\/.*; rv:)(\d+)/);return!!e&&parseInt(e[1])},n.prototype.newHttpRequest=function(e,t,r){this.requestAttempts++;var n,i=this;for(var o in r=r||function(){},window.XDomainRequest?(n=new XDomainRequest).onload=function(){r(n.responseText)}:n=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),n.onreadystatechange=function(){if(4===n.readyState){if(200===n.status)return r(n.responseText),void(i.requestAttempts=0);i.requestAttempts<3?setTimeout(function(){i.newHttpRequest(e,t,r)},3e3):(r({error:n.responseText}),i.loader(),i.requestAttempts=0)}},t=t||{},n.open("GET",e,!0),t)t.hasOwnProperty(o)&&n.setRequestHeader(o,t[o]);t.cache||(n.setRequestHeader("cache-control","no-cache"),n.setRequestHeader("expires","-1"),n.setRequestHeader("pragma","no-cache")),n.send()},n.prototype.ajaxRequest=function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("Url is required.")}),!1;var n={url:e,type:"GET",contentType:"text/plain",timeout:5e3,cache:!1};t=t||n,t=$.extend({},n,t),this.requestAttempts++;var i=this;$.ajax(t).done(function(e){r(e),i.requestAttempts=0}).fail(function(){i.requestAttempts<=3?setTimeout(function(){i.ajaxRequest(e,t,r)},3e3):(r({error:i18next.t("Error occurred processing request")}),i.requestAttempts=0,i.loader())}).always(function(){i.loader()})},n.prototype.initWorker=function(e,t,r){var n=new Worker("/static/js/ajaxWorker.js"),i=this;n.postMessage({url:e,params:t}),n.addEventListener("message",function(e){r.call(i,e.data),n.terminate()},!1),n.addEventListener("error",function(e){console.log("Worker runtime error: Line ",e.lineno," in ",e.filename,": ",e.message),n.terminate()},!1)},n.prototype.workerAllowed=function(){return window.Worker&&!this.isTouchDevice()},n.prototype.getRequestMethod=function(){return this.getIEVersion()?this.newHttpRequest:this.ajaxRequest},n.prototype.sendRequest=function(e,t,r){if((t=t||{}).useWorker&&this.workerAllowed())return this.initWorker(e,t,r),!0;this.getRequestMethod().call(this,e,t,function(e){r.call(this,e)})},n.prototype.LRKeyEvent=function(){$(".button--LR").length>0&&$("html").on("keydown",function(e){parseInt(e.keyCode)===parseInt(187)&&$(".button--LR").toggleClass("data-show")})},n.prototype.getLoaderHTML=function(e){return'<div class="loading-message-indicator"><i class="fa fa-spinner fa-spin fa-2x"></i>'.concat(e?"&nbsp;"+e:"","</div>")},n.prototype.convertToNumericField=function(e){e&&this.isTouchDevice()&&e.each(function(){$(this).prop("type","tel")})},n.prototype.isString=function(e){return"[object String]"===Object.prototype.toString.call(e)},n.prototype.disableHeaderFooterLinks=function(){var e=$("#tnthNavWrapper a, #homeFooter a").not("a[href*='logout']").not("a.required-link").not("a.home-link");e.addClass("disabled"),e.prop("onclick",null).off("click"),e.on("click",function(e){return e.preventDefault(),!1})},n.prototype.pad=function(e){return e=parseInt(e),!isNaN(e)&&e<10?"0"+e:e},n.prototype.escapeHtml=function(e){return null===e||"undefined"!==e||0===String(e).length?e:e.replace(/[\"&'\/<>]/g,function(e){return{'"':"&quot;","&":"&amp;","'":"&#39;","/":"&#47;","<":"&lt;",">":"&gt;"}[e]})},n.prototype.containHtmlTags=function(e){return!!e&&/[<>]/.test(e)},n.prototype.getExportFileName=function(e){var t=new Date;return(e||"ExportList_")+("00"+t.getDate()).slice(-2)+("00"+(t.getMonth()+1)).slice(-2)+t.getFullYear()},n.prototype.capitalize=function(e){return e.replace(/\w\S*/g,function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()})},n.prototype.restoreVis=function(){var e=document.getElementById("loadingIndicator"),t=document.getElementById("mainHolder");e&&e.setAttribute("style","display:none; visibility:hidden;"),t&&t.setAttribute("style","visibility:visible;-ms-filter:'progid:DXImageTransform.Microsoft.Alpha(Opacity=100)';filter:alpha(opacity=100); -moz-opacity:1; -khtml-opacity:1; opacity:1")},n.prototype.VueErrorHandling=function(){if("undefined"==typeof Vue)return!1;var e=this;Vue.config.errorHandler=function(t,r,n){var i,o=r;if(r.$options.errorHandler)i=r.$options.errorHandler;else for(;!i&&o.$parent;)i=(o=o.$parent).$options.errorHandler;e.restoreVis(),i?i.call(o,t,r,n):console.log(t)}},n.prototype.extend=function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r]);return e},n.prototype.getUrlParameter=function(e){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var t=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(location.search);return null===t?"":decodeURIComponent(t[1])},n.prototype.resetBrowserBackHistory=function(e,t,r){var n="undefined"!=typeof history&&history.pushState;e=e||location.href,n&&history.pushState(t,r,e),window.addEventListener("popstate",function(){n?history.pushState(t,r,e):window.history.forward(1)})},n.prototype.handlePostLogout=function(){if("undefined"==typeof sessionStorage)return!1;sessionStorage.getItem("logout")&&(this.resetBrowserBackHistory(location.orgin,"logout"),sessionStorage.removeItem("logout"))},n.prototype.displaySystemOutageMessage=function(e){if(e=(e=e||"en-us").replace("_","-"),document.getElementById("systemMaintenanceContainer")){var t=this;this.ajaxRequest("api/settings",{contentType:"application/json; charset=utf-8"},function(r){if(!r||!r.MAINTENANCE_MESSAGE&&!r.MAINTENANCE_WINDOW)return!1;var n=document.querySelector(".message-container");if(n||((n=document.createElement("div")).classList.add("message-container"),document.getElementById("systemMaintenanceContainer").appendChild(n)),r.MAINTENANCE_MESSAGE)n.innerHTML=t.escapeHtml(r.MAINTENANCE_MESSAGE);else if(r.MAINTENANCE_WINDOW&&r.MAINTENANCE_WINDOW.length){var i,o,s=new Date(r.MAINTENANCE_WINDOW[0]),a=new Date(r.MAINTENANCE_WINDOW[1]),u=(i=new Date,o=s,i&&o?Math.floor((o.getTime()-i.getTime())/36e5%24):0);if(u<0||isNaN(u))document.getElementById("systemMaintenanceContainer").classList.add("tnth-hide");else try{var c={year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric",hour12:!0,timeZoneName:"short"},d=s.toLocaleString(e,c).replace(/[,]/g," "),l=a.toLocaleString(e,c).replace(/[,]/g," "),f=["<div>"+i18next.t("Hi there.")+"</div>","<div>"+i18next.t("TrueNTH will be down for website maintenance starting <b>{startdate}</b>. This should last until <b>{enddate}</b>.".replace("{startdate}",d).replace("{enddate}",l))+"</div>","<div>"+i18next.t("Thanks for your patience while we upgrade our site.")+"</div>"].join("");n.innerHTML=t.escapeHtml(f)}catch(e){console.log("Error occurred converting system outage date/time ",e),document.getElementById("systemMaintenanceContainer").classList.add("tnth-hide")}}})}},new n);t.a=i;var o=i.getExportFileName,s=i.getUrlParameter},19:function(e,t,r){"use strict";r.r(t);var n,i=r(3),o=r(0),s=r(6);n=function(){this.subjectId=null,this.init=function(e){var t=this;this.setSubjectId(e,function(){t.subjectId&&(t.getDemoData(),t.initFieldEvents(),t.setFooter())})},this.setSubjectId=function(e,t){t=t||function(){};var r=this;this.subjectId=e||$("#coreDataUserId").val(),this.subjectId?t({success:1}):i.a.getCurrentUser(function(e){if(!e||e.error)return r.setError(i18next.t("Error occurred retrieving subject ID")),void t({error:!0});r.subjectId=e.id,t(e)})},this.demoFieldsEnabled=function(){return this.getRaceFields().length||this.getEthnicityFields().length},this.getRaceFields=function(){return $("#userRace input:checkbox")},this.getEthnicityFields=function(){return $("#userEthnicity input:checkbox")},this.getEthnicityData=function(){var e=this.getEthnicityFields().filter(":checked");if(!e.length)return!1;var t=e.map(function(){return{code:$(this).val(),system:o.a.ethnicity_system}}).get();return{url:o.a.ethnicity,valueCodeableConcept:{coding:t}}},this.getRaceData=function(){var e=this.getRaceFields().filter(":checked");if(!e.length)return!1;var t=e.map(function(){return{code:$(this).val(),system:o.a.race_system}}).get();return{url:o.a.race,valueCodeableConcept:{coding:t}}},this.setDemoData=function(){if(this.demoFieldsEnabled()){var e=this.getRaceData(),t=this.getEthnicityData(),r={resourceType:"Patient",extension:[]};e&&r.extension.push(e),t&&r.extension.push(t),i.a.putDemo(this.subjectId,r)}},this.getDemoData=function(){this.demoFieldsEnabled()&&i.a.getDemo(this.subjectId)},this.initDemoFieldEvents=function(){if(this.demoFieldsEnabled()){var e=this;this.getRaceFields().on("click",function(){e.setDemoData()}),this.getEthnicityFields().on("click",function(){e.setDemoData()})}},this.initContinueButtonEvent=function(){var e=this;$(".continue-btn").on("click",function(t){t.preventDefault(),$(this).attr("disabled",!0),$(".loading-indicator").show();try{window.location.replace(e.getReturnAddress())}catch(t){e.setError(i18next.t("Error occurred - unable to reach destination")),i.a.reportError(e.subjectId,e.getAPIUrl(),t.message,!0),$(this).attr("disabled",!1),$(".loading-indicator").hide(),$(".error-continue").text(t.message)}})},this.initFieldEvents=function(){this.initDemoFieldEvents(),this.initContinueButtonEvent()},this.getReturnAddress=function(){return $("#procReturnAddress").val()||"/"},this.getAPIUrl=function(){return $("procAPIUrl").val()||"/api/coredata/acquire"},this.setError=function(e){$("#coreDataError").html(e||"")},this.setFooter=function(){var e=this;i.a.setting("GIL",this.subjectId,!1,function(t){t&&t.GIL&&i.a.getPortalFooter(e.subjectId,!1,"core_data_footer")})}},$(document).ready(function(){s.a.initViaTemplate(),(new n).init()})},2:function(e,t,r){"use strict";r.d(t,"b",function(){return i});var n={validateDateInputFields:function(e,t,r,n){var i=$(e).val(),o=$(t).val(),s=$(r).val();if(i&&o&&s){if($(r).get(0).validity.valid&&$(e).get(0).validity.valid&&$(t).get(0).validity.valid){i=parseInt(i),o=parseInt(o),s=parseInt(s);var a=$("#"+n);if(isNaN(i)||isNaN(o)||isNaN(s))return!1;var u=new Date,c=new Date(s,i-1,o);return c.getFullYear()!==s||c.getMonth()+1!==i||c.getDate()!==o?(a.html(i18next.t("Invalid date. Please try again.")).show(),!1):c.setHours(0,0,0,0)>u.setHours(0,0,0,0)?(a.html(i18next.t("Date must not be in the future. Please try again.")).show(),!1):s<1900?(a.html(i18next.t("Date must not be before 1900. Please try again.")).show(),!1):(a.html("").hide(),!0)}return!1}return!1},swap_mm_dd:function(e){var t=e.split("/");return t[1]+"/"+t[0]+"/"+t[2]},convertMonthNumeric:function(e){if(e){var t={jan:1,feb:2,mar:3,apr:4,may:5,jun:6,jul:7,aug:8,sep:9,oct:10,nov:11,dec:12}[e.toLowerCase()];return t||""}return""},convertMonthString:function(e){if(e){var t={1:"Jan",2:"Feb",3:"Mar",4:"Apr",5:"May",6:"Jun",7:"Jul",8:"Aug",9:"Sep",10:"Oct",11:"Nov",12:"Dec"}[parseInt(e)];return t||""}return""},isDate:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},displayDateString:function(e,t,r){var n="";return n+=t||"",e&&(n+=(n?" ":"")+this.convertMonthString(e)),r&&(n+=(n?" ":"")+r),n},getDateDiff:function(e,t){if(!e)return 0;var r,n=e.split(/[^0-9]/),i=new Date(n[0],n[1]-1,n[2]).getTime();if(t){var o=t.split(/[^0-9]/);r=new Date(o[0],o[1]-1,o[2]).getTime()}else r=(new Date).getTime();return Math.floor((r-i)/864e5)},isValidDefaultDateFormat:function(e,t){if(!e||e.length<10)return!1;var r=$.trim(e).split(" ");if(r.length<3)return!1;var n=parseInt(r[0])+"",i=r[1],o=r[2];if(n.length<1||i.length<3||o.length<4)return!1;if(!/(0)?[1-9]|1\d|2\d|3[01]/.test(n))return!1;if(!/jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec/i.test(i))return!1;if(!/(19|20)\d{2}/.test(o))return!1;var s=new Date(e);if(this.isDateObj(s)){if(this.isValidDate(o,this.convertMonthNumeric(i),n)){var a=new Date,u="";return s.getFullYear()<1900&&(u="Year must be after 1900"),s.setHours(0,0,0,0)>a.setHours(0,0,0,0)&&(u="The date must not be in the future."),u?($(t).text(u),!1):($(t).text(""),!0)}return!1}return!1},isDateObj:function(e){return"[object Date]"===Object.prototype.toString.call(e)&&!isNaN(e.getTime())},isValidDate:function(e,t,r){var n=this.getDateObj(e,t,r),i=this.getConvertedDate(n),o=this.getGivenDate(e,t,r);return String(o)===String(i)},getDateObj:function(e,t,r,n,i,o){return n=n||0,i=i||0,o=o||0,new Date(parseInt(e),parseInt(t)-1,parseInt(r),parseInt(n),parseInt(i),parseInt(o))},getConvertedDate:function(e){return e&&this.isDateObj(e)?""+e.getFullYear()+(e.getMonth()+1)+e.getDate():""},getGivenDate:function(e,t,r){return""+e+t+r},formatDateString:function(e,t){if(e){var r,n,i,o,s,a,u,c=/^([\+-]?\d{4}(?!\d{2}\b))((-?)((0[1-9]|1[0-2])(\3([12]\d|0[1-9]|3[01]))?|W([0-4]\d|5[0-2])(-?[1-7])?|(00[1-9]|0[1-9]\d|[12]\d{2}|3([0-5]\d|6[1-6])))([T\s]((([01]\d|2[0-3])((:?)[0-5]\d)?|24\:?00)([\.,]\d+(?!:))?)?(\17[0-5]\d([\.,]\d+)?)?([zZ]|([\+-])([01]\d|2[0-3]):?([0-5]\d)?)?)?)?$/,d=new Date(e);if(!c&&!isNaN(d)&&!this.isDateObj(d))return"";if(c.test(e)){var l=$.trim($.trim(e).replace(/[\.TZ:\-]/gi," ")).split(" ");i=l[0],n=l[1],r=l[2],o=l[3]||"0",s=l[4]||"0",a=l[5]||"0"}else r=d.getDate(),n=d.getMonth()+1,i=d.getFullYear(),o=d.getHours(),s=d.getMinutes(),a=d.getSeconds(),u="";var f=function(e){return(e=parseInt(e))<10?"0"+e:e};switch(r=f(r),n=f(n),o=f(o),s=f(s),a=f(a),t){case"mm/dd/yyyy":u=n+"/"+r+"/"+i;break;case"mm-dd-yyyy":u=n+"-"+r+"-"+i;break;case"mm-dd-yyyy hh:mm:ss":u=n+"-"+r+"-"+i+" "+o+":"+s+":"+a;break;case"dd/mm/yyyy":u=r+"/"+n+"/"+i;break;case"dd/mm/yyyy hh:mm:ss":u=r+"/"+n+"/"+i+" "+o+":"+s+":"+a;break;case"dd-mm-yyyy":u=r+"-"+n+"-"+i;break;case"dd-mm-yyyy hh:mm:ss":u=r+"-"+n+"-"+i+" "+o+":"+s+":"+a;break;case"iso-short":case"yyyy-mm-dd":u=i+"-"+n+"-"+r;break;case"iso":case"yyyy-mm-dd hh:mm:ss":u=i+"-"+n+"-"+r+" "+o+":"+s+":"+a;break;case"system":u=i+"-"+n+"-"+r+"T"+o+":"+s+":"+a+"Z";break;case"d M y hh:mm:ss":u=(u=this.displayDateString(n,r,i))+" "+o+":"+s+":"+a;break;case"d M y":default:u=this.displayDateString(n,r,i)}return u}return""},convertToLocalTime:function(e){var t="";if(e){var r=new Date(e),n=new Date(r.getTime()+60*r.getTimezoneOffset()*1e3),i=r.getTimezoneOffset()/60,o=r.getHours();n.setHours(o-i);t=n.toLocaleString({year:"numeric",day:"numeric",month:"short",hour:"numeric",minute:"numeric",second:"numeric",hour12:!1})}return t},getDateWithTimeZone:function(e){var t=new Date(e.getTime()+60*e.getTimezoneOffset()*1e3);return this.formatDateString(t,"yyyy-mm-dd hh:mm:ss")},getTodayDateObj:function(){var e=new Date,t=e.getDate(),r=e.getMonth()+1,n=e.getFullYear(),i=e.getHours(),o=e.getMinutes(),s=e.getSeconds(),a=this.getDateWithTimeZone(this.getDateObj(n,r,t,i,o,s)),u=function(e){return(e=parseInt(e))<10?"0"+e:e};return{date:e,day:t,month:r,year:n,hour:i,minute:o,second:s,displayDay:u(t),displayMonth:u(r),displayYear:u(n),displayHour:u(i),displayMinute:u(o),displaySecond:u(s),gmtDate:a}},dateValidator:function(e,t,r,n){var i="";if(e&&t&&r){var o=parseInt(r),s=parseInt(t),a=parseInt(e),u=new Date(o,s-1,a);if(u.getFullYear()===o&&u.getMonth()+1===s&&u.getDate()===a){if(o<1900&&(i=i18next.t("Year must be after 1900")),n){var c=new Date;u.setHours(0,0,0,0)>c.setHours(0,0,0,0)&&(i=i18next.t("The date must not be in the future."))}}else i=i18next.t("Invalid Date. Please enter a valid date.")}else i=i18next.t("Missing value.");return i}};t.a=n;var i=n.validateDateInputFields},3:function(e,t,r){"use strict";var n=r(1),i=r(2),o=r(0),s={biopsy:{code:"111",display:"biopsy"},pca_diag:{code:"121",display:"PCa diagnosis"},pca_localized:{code:"141",display:"PCa localized diagnosis"}};t.a={beforeSend:function(){$.ajaxSetup({beforeSend:function(e,t){/^(GET|HEAD|OPTIONS|TRACE)$/i.test(t.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",$("#__CRSF_TOKEN").val())}})},sendRequest:function(e,t,r,i,o){if(!e)return!1;var s={type:t||"GET",url:e,attempts:0,max_attempts:3,contentType:"application/json; charset=utf-8",dataType:"json",sync:!1,timeout:5e3,data:null,useWorker:!1,async:!0};i=i||s,(i=$.extend({},s,i)).async=!i.sync&&i.async;var a=this,u=this.FieldLoaderHelper,c=i.targetField||null;if(o=o||function(){},i.attempts++,u.showLoader(c),i.useWorker&&window.Worker&&!n.a.isTouchDevice())return n.a.initWorker(e,i,function(t){var n;try{n=JSON.parse(t)}catch(t){return o({error:"Error occurred parsing data for "+e}),!1}n?n.error?(o({error:!0,data:n}),a.sendError(n,e,r,i),u.showError(c)):(o(n),u.showUpdate(c)):(o({error:!0,data:"no data returned"}),u.showError(c))}),!0;i.cache||(i.headers={"cache-control":"no-cache",expires:"-1",pragma:"no-cache"}),$.ajax(i).done(function(e){i.attempts=0,e?(u.showUpdate(c),o(e)):(u.showError(c),o({error:!0,data:"no data returned"}))}).fail(function(n){i.attempts<i.max_attempts?function(e,t,r,n,i,o){setTimeout(function(){e.sendRequest(t,r,n,i,o)},3e3)}(a,e,t,r,i,o):(i.attempts=0,u.showError(c),o({error:!0,data:n}),a.sendError(n,e,r,i))})},sendError:function(e,t,r,n){if(!e)return!1;var i="[Error occurred processing request]  status - "+(0===parseInt(e.status)?"request timed out/network error":e.status)+", response text - "+(e.responseText?e.responseText:"no response text returned from server");if(n)try{i+=" [data sent]: "+JSON.stringify(n)}catch(e){i+=" Error occurred transforming sent data: "+e.message}this.reportError(r||"Not available",t,i,!0)},reportError:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1?arguments[1]:void 0,r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3?arguments[3]:void 0,i={};t=t||window.location.href,i.subject_id=e,i.page_url=t,i.message="Error generated in JS - "+(r?r.replace(/["']/g,""):"no detail available"),console.log("Errors occurred....."),console.log(i),$.ajax({type:"GET",url:"/report-error",contentType:"application/json; charset=utf-8",cache:!1,async:!n,data:i}).done(function(){}).fail(function(){})},FieldLoaderHelper:{delayDuration:300,showLoader:function(e){if(!e||0===e.length)return!1;var t=$("#"+(e.attr("data-save-container-id")||e.attr("id"))+"_load");t.css("opacity",1),t.addClass("loading")},showUpdate:function(e){var t=this.delayDuration;if(!e||0===e.length)return!1;setTimeout(function(){!function(e){var r=e.attr("data-save-container-id")||e.attr("id"),n=$("#"+r+"_error"),i=$("#"+r+"_success"),o=$("#"+r+"_load");o.removeClass("loading"),n.text("").css("opacity",0),i.text(i18next.t("success")),o.animate({opacity:0},t,function(){i.animate({opacity:1},t,function(){setTimeout(function(){i.animate({opacity:0},2*t)},2*t)})})}(e)},t)},showError:function(e){e=e||$(e);var t=this.delayDuration;if(!e||0===e.length)return!1;setTimeout(function(){!function(e){var r=e.attr("data-save-container-id")||e.attr("id"),n=$("#"+r+"_error"),i=$("#"+r+"_success"),o=$("#"+r+"_load");o.removeClass("loading"),n.text(i18next.t("Unable to update. System/Server Error.")),i.text("").css("opacity",0),o.animate({opacity:0},t,function(){n.animate({opacity:1},t,function(){setTimeout(function(){n.animate({opacity:0},2*t)},2*t)})})}(e)},t)}},getCurrentUser:function(e,t){e=e||function(){},sessionStorage.currentUser?e(JSON.parse(sessionStorage.currentUser)):this.sendRequest("/api/me","GET","",t,function(t){t&&t.id&&sessionStorage.setItem("currentUser",JSON.stringify(t)),e(t)})},getStillNeededCoreData:function(e,t,r,n){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;var i="/api/coredata/user/"+e+"/still_needed"+(n?"?entry_method="+n.replace(/\_/g," "):"");this.sendRequest(i,"GET",e,{sync:t,cache:!0},function(e){return e?e.error?(r({error:i18next.t("unable to get needed core data")}),!1):void r(e):(r({error:i18next.t("no data returned")}),!1)})},getRequiredCoreData:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;this.sendRequest("/api/coredata/user/"+e+"/required","GET",e,{sync:t,cache:!0},function(e){e?e.error?r({error:i18next.t("unable to get required core data")}):e.required?r(e.required):r({error:i18next.t("no data returned")}):r({error:i18next.t("no data returned")})})},getOptionalCoreData:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User Id is required")}),!1;var n="/api/coredata/user/"+e+"/optional",i="optionalCoreData_"+e;sessionStorage.getItem(i)?r(JSON.parse(sessionStorage.getItem(i))):this.sendRequest(n,"GET",e,t,function(e){r(e||{error:i18next.t("no data found")})})},getPortalFooter:function(e,t,r,n){if(n=n||function(){},!e)return n("<div class='error-message'>"+i18next.t("User Id is required")+"</div>"),!1;this.sendRequest("/api/portal-footer-html/","GET",e,{sync:t,cache:!0,dataType:"html"},function(e){e?e.error?n("<div class='error-message'>"+i18next.t("Unable to retrieve portal footer html")+"</div>"):(r&&$("#"+r).html(e),n(e)):n("<div class='error-message'>"+i18next.t("No data found")+"</div>")})},getOrgs:function(e,t,r){r=r||function(){},this.sendRequest("/api/organization","GET",e,t,function(e){if(sessionStorage.demoOrgsData)return r(JSON.parse(sessionStorage.demoOrgsData)),!0;if(e.error){var t=i18next.t("Server error occurred retrieving organization/clinic information.");$(".get-orgs-error").html(t),r({error:t})}else $(".get-orgs-error").html(""),sessionStorage.setItem("demoOrgsData",JSON.stringify(e)),r(e)})},getConsent:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/consent","GET",e,t,function(e){if(e){if(e.error){var t=i18next.t("Server error occurred retrieving consent information.");return r({error:t}),$(".get-consent-error").html(t),!1}return $(".get-consent-error").html(""),r(e),!0}})},setConsent:function(e,t,r,n,i){if(i=i||function(){},!e&&!t)return i({error:i18next.t("User id and parameters are required")}),!1;var o="/api/user/"+e+"/consent";if(!this.hasConsent(e,t.org,r)||t.testPatient){var s={};s.user_id=e,s.organization_id=t.org,s.agreement_url=t.agreementUrl,s.staff_editable="null"!==String(t.staff_editable)&&"undefined"!==String(t.staff_editable)&&t.staff_editable,s.include_in_reports="null"!==String(t.include_in_reports)&&"undefined"!==String(t.include_in_reports)&&t.include_in_reports,s.send_reminders="null"!==String(t.send_reminders)&&"undefined"!==String(t.send_reminders)&&t.send_reminders,t.acceptance_date&&(s.acceptance_date=t.acceptance_date),this.sendRequest(o,"POST",e,{sync:n,data:JSON.stringify(s)},function(e){if(e.error){var t=i18next.t("Server error occurred setting consent status.");i({error:t}),$(".set-consent-error").html(t)}else $(".set-consent-error").html(""),i(e)})}else i({error:!1})},deleteConsent:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!e)return!1;var r=this.getAllValidConsent(e,t.org);if(!r)return!1;var n=t.exclude?t.exclude.split(","):[],i=$.grep(r,function(e){return!$.grep(n,function(t){return String(t)===String(e)}).length}),o=this;i.forEach(function(t){o.sendRequest("/api/user/"+e+"/consent","DELETE",e,{data:JSON.stringify({organization_id:parseInt(t)})},function(e){if(!e)return!1;e.error?$(".delete-consent-error").html(i18next.t("Server error occurred removing consent.")):$(".delete-consent-error").html("")})})},withdrawConsent:function(e,t,r,n){if(n=n||function(){},r=r||{},!e||!t)return n({error:i18next.t("User id and organization id are required.")}),!1;var o=this,s=[];this.sendRequest("/api/user/"+e+"/consent","GET",e,r,function(a){if(a&&a.consent_agreements&&a.consent_agreements.length&&(s=$.grep(a.consent_agreements,function(e){var r=i.a.getDateDiff(String(e.expires));return!(String(t)!==String(e.organization_id)||e.deleted||r>0||"suspended"!==String(e.status))})),s.length)return n({data:"success"}),!1;o.sendRequest("/api/user/"+e+"/consent/withdraw","POST",e,{sync:r.sync,data:JSON.stringify({organization_id:t})},function(e){if(e.error)return n({error:i18next.t("Error occurred setting suspended consent status.")}),!1;n(e)})})},getAllValidConsent:function(e,t){if(!e||!t)return!1;var r=[];return this.sendRequest("/api/user/"+e+"/consent","GET",e,{sync:!0},function(e){return e&&!e.error&&e.consent_agreements&&e.consent_agreements.length?r=(r=$.grep(e.consent_agreements,function(e){var r=i.a.getDateDiff(String(e.expires));return!(e.deleted||r>0||"all"!==String(t).toLowerCase()&&String(t)!==String(e.organization_id))})).map(function(e){return e.organization_id}):r}),r},hasConsent:function(e,t,r){if(!e||!t||"default"===String(r))return!1;var n=[],o="/api/user/"+e+"/consent";return this.sendRequest(o,"GET",e,{sync:!0},function(e){if(!e||e.error||e.consent_agreements&&0===e.consent_agreements.length)return!1;n=$.grep(e.consent_agreements,function(e){var r=e.expires?i.a.getDateDiff(String(e.expires)):0;return String(t)===String(e.organization_id)&&!e.deleted&&!(r>0)&&e.staff_editable&&e.send_reminders&&e.include_in_reports})}),n.length},getDemo:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;t=t||{};var n="demoData_"+e;sessionStorage.getItem(n)?r(JSON.parse(sessionStorage.getItem(n))):this.sendRequest("/api/demographics/"+e,"GET",e,t,function(e){var t="";if(e.error)return t=i18next.t("Server error occurred retrieving demographics information."),$(".get-demo-error").html(t),r({error:t}),!1;$(".get-demo-error").html(t),sessionStorage.setItem(n,JSON.stringify(e)),r(e)})},clearDemoSessionData:function(e){sessionStorage.removeItem("demoData_"+e)},putDemo:function(e,t,r,n,i){if(i=i||function(){},!e)return i({error:i18next.t("User Id is required")}),!1;this.clearDemoSessionData(e),this.sendRequest("/api/demographics/"+e,"PUT",e,{sync:n,data:JSON.stringify(t),targetField:r},function(e){e.error?$(".put-demo-error").html(i18next.t("Server error occurred setting demographics information.")):$(".put-demo-error").html(""),i(e)})},getLocale:function(e){this.sendRequest("/api/demographics/"+e,"GET",e,null,function(e){e&&(e.error?$("#profileLocaleTimezoneContainer .get-locale-error").html(i18next.t("Server error occurred retrieving locale information.")):e.communication&&$("#profileLocaleTimezoneContainer .get-locale-error").html(""))})},hasTreatment:function(e){if(!e||!e.entry||0===e.entry.length)return!1;var t=e.entry.sort(function(e,t){return new Date(t.resource.meta.lastUpdated)-new Date(e.resource.meta.lastUpdated)}),r=!1;return t.forEach(function(e){if(r)return!0;var t=String(e.resource.code.coding[0].code),n=String(e.resource.code.coding[0].system),i=e.resource.id;(t===o.a.CANCER_TREATMENT_CODE&&n===o.a.SNOMED_SYS_URL||t===o.a.NONE_TREATMENT_CODE&&n===o.a.CLINICAL_SYS_URL)&&(r={code:t,id:i})}),r},getTreatment:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/patient/"+e+"/procedure","GET",e,t,function(e){e.error&&$("#userProcedures").html("<span class='error-message'>"+i18next.t("Error retrieving data from server")+"</span>"),r(e)})},postTreatment:function(e,t,r,n){if(!e)return!1;this.deleteTreatment(e,n);var i=o.a.NONE_TREATMENT_CODE,s="None",a=o.a.CLINICAL_SYS_URL;if(t&&(i=o.a.CANCER_TREATMENT_CODE,s="Procedure on prostate",a=o.a.SNOMED_SYS_URL),!r){var u=new Date;r=u.getFullYear()+"-"+(u.getMonth()+1)+"-"+u.getDate()}var c=[{code:i,display:s,system:a}],d={resourceType:"Procedure"};d.subject={reference:"Patient/"+e},d.code={coding:c},d.performedDateTime=r||"",this.postProc(e,d,n)},deleteTreatment:function(e,t){var r=this;this.sendRequest("/api/patient/"+e+"/procedure","GET",e,{sync:!0},function(e){if(!e||e.error)return!1;var n=r.hasTreatment(e);return!!n&&(String(n.code)===String(o.a.CANCER_TREATMENT_CODE)?(r.deleteProc(n.id,t,!0),!0):void r.deleteProc(n.id,t,!0))})},getProc:function(e,t,r){r=r||function(){},this.sendRequest("/api/patient/"+e+"/procedure","GET",e,null,function(e){r(e)})},postProc:function(e,t,r,n){n=n||function(){},this.sendRequest("/api/procedure","POST",e,{data:JSON.stringify(t),targetField:r},function(e){if(!e)return n({error:i18next.t("no data returned")}),!1;if(e.error){var t=i18next.t("Server error occurred saving procedure/treatment information.");return $("#userProcuedures .get-procs-error").html(t),n({error:t}),!1}$(".get-procs-error").html(""),n(e)})},deleteProc:function(e,t,r){this.sendRequest("/api/procedure/"+e,"DELETE",null,{sync:r,targetField:t},function(e){e.error?$(".del-procs-error").html(i18next.t("Server error occurred removing procedure/treatment information.")):$(".del-procs-error").html("")})},getRoleList:function(e,t){this.sendRequest("/api/roles","GET",null,e,function(e){if(t=t||function(){},e.error){var r=i18next.t("Server error occurred retrieving roles information.");$(".get-roles-error").html(r),t({error:r})}else t(e)})},getRoles:function(e,t,r){t=t||function(){};var n="userRole_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));t(i)}else this.sendRequest("/api/user/"+e+"/roles","GET",e,r,function(e){if(e)if(e.error){var r=i18next.t("Server error occurred retrieving user role information.");$(".get-roles-error").html(r),t({error:r})}else $(".get-roles-error").html(""),sessionStorage.setItem(n,JSON.stringify(e)),t(e)})},removeCachedRoles:function(e){sessionStorage.removeItem("userRole_"+e)},putRoles:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("User Id is required.")}),!1;this.removeCachedRoles(e),this.sendRequest("/api/user/"+e+"/roles","PUT",e,{data:JSON.stringify(t),targetField:r},function(t){if(!t||t.error){var r=i18next.t("Server error occurred setting user role information.");return $(".put-roles-error").html(r),void n({error:r})}$(".put-roles-error").html(""),sessionStorage.setItem("userRole_"+e,""),n(t)})},deleteRoles:function(e,t){if(!e)return!1;this.removeCachedRoles(e),this.sendRequest("/api/user/"+e,"GET",e,{data:JSON.stringify(t)},function(e){e&&(e.error?$(".delete-roles-error").html(i18next.t("Server error occurred deleting user role.")):$(".delete-roles-error").html(""))})},getClinical:function(e,t,r){r=r||function(){},this.sendRequest("/api/patient/"+e+"/clinical","GET",e,t,function(e){if(e)if(e.error){var t=i18next.t("Server error occurred retrieving clinical data.");$(".get-clinical-error").html(t),r({error:t})}else $(".get-clinical-error").html(""),r(e)})},getObservationId:function(e,t){if(!e)return!1;var r="",n="";return this.sendRequest("/api/patient/"+e+"/clinical","GET",e,{sync:!0},function(e){e&&(e.error||e.entry&&e.entry.forEach(function(e){r||(n=e.content.code.coding[0].code,String(n)===String(t)&&(r=e.content.id))}))}),r},postClinical:function(e,t,r,n,i,a,u){if(!e)return!1;a=a||{};var c="",d="";if(s.hasOwnProperty(String(t).toLowerCase())){var l=s[t];c=l.code,d=l.display}if(!c)return!1;var f="POST",p="/api/patient/"+e+"/clinical",h=[{code:c,display:d,system:o.a.CLINICAL_SYS_URL}],g={resourceType:"Observation"};g.code={coding:h},g.issued=a.issuedDate?a.issuedDate:"",g.status=n||"",g.valueQuantity={units:"boolean",value:r},a.performer&&(g.performer=a.performer);var m=this.getObservationId(e,c);m&&(f="PUT",p=p+"/"+m),u=u||function(){},this.sendRequest(p,f,e,{data:JSON.stringify(g),targetField:i},function(e){if(!e||e.error){var t=i18next.t("Server error occurred updating clinical data.");return $(".post-clinical-error").html(t).show(),void u({error:t})}$(".post-clinical-error").html("").hide(),u(e)})},getTermsUrl:function(e,t){t=t||function(){},this.sendRequest("/api/tou","GET",null,{sync:e},function(e){e&&(e.error?($(".get-tou-error").html(i18next.t("Server error occurred retrieving tou url.")),t({error:i18next.t("Server error")})):($(".get-tou-error").html(""),e.url?($("#termsURL").attr("data-url",e.url),$("#termsCheckbox_default .terms-url").attr("href",e.url),t({url:e.url})):t({error:i18next.t("no url returned")})))})},getInstrumentsList:function(e,t){t=t||function(){},this.sendRequest("api/questionnaire_bank","GET",null,{sync:e},function(e){if(e&&!e.error)if(e.entry&&e.entry.length){var r={};e.entry.forEach(function(e){if(e.organization){var t=e.organization.reference.split("/")[2];r[t]||(r[t]=[]),e.questionnaires&&e.questionnaires.forEach(function(e){-1===$.inArray(e.questionnaire.display,r[t])&&r[t].push(e.questionnaire.display)})}}),t(r)}else t({error:i18next.t("no data returned")});else t({error:i18next.t("error retrieving instruments list")})})},getTerms:function(e,t,r,n,i){n=n||function(){},i=i||{};var o="/api/user/{userId}/tou{type}{all}".replace("{userId}",e).replace("{type}",t?"/"+t:"").replace("{all}",i.hasOwnProperty("all")?"?all=true":"");this.sendRequest(o,"GET",e,{sync:r},function(e){if(!e||e.error){var t=i18next.t("Server error occurred retrieving tou data.");return $(".get-tou-error").html(t),void n({error:t})}$(".get-tou-error").html(""),n(e)})},postTermsByUser:function(e,t,r){r=r||function(){},this.sendRequest("/api/user/"+e+"/tou/accepted","POST",e,{data:JSON.stringify(t)},function(e){if(!e||e.error)return $(".post-tou-error").html(i18next.t("Server error occurred saving terms of use information.")),void r(e);$(".post-tou-error").html(""),r(e)})},postTerms:function(e,t,r){r=r||function(){},this.sendRequest("/api/tou/accepted","POST",null,{data:JSON.stringify(e),targetField:t},function(e){if(!e||e.error){var t=i18next.t("Server error occurred saving terms of use information.");return $(".post-tou-error").html(t),void r({error:t})}$(".post-tou-error").html(""),r(e)})},accessUrl:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/access_url","GET",e,{sync:t},function(e){e?e.error?r({error:i18next.t("Error occurred retrieving access url.")}):r({url:e.access_url}):r({error:i18next.t("no data returned")})})},invite:function(e,t,r){if(r=r||function(){},!t)return r({error:i18next.t("Invite data are required.")}),!1;this.sendRequest("/invite","POST",e,{contentType:"application/x-www-form-urlencoded; charset=UTF-8",data:t,dataType:"html"},function(e){r(e||{error:i18next.t("no data returned")})})},passwordReset:function(e,t){if(t=t||function(){},!e)return t({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/password_reset","POST",e,{contentType:"application/x-www-form-urlencoded; charset=UTF-8"},function(e){e?e.error?t({error:i18next.t("Error occurred sending password reset request.")}):t(e):t({error:i18next.t("no data returned")})})},assessmentStatus:function(e,t){if(t=t||function(){},!e)return t({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment-status","GET",e,null,function(e){e?e.error?t({error:i18next.t("Error occurred retrieving assessment status.")}):t(e):t({error:i18next.t("no data returned")})})},updateAssessment:function(e,t,r){return r=r||function(){},e?t?void this.sendRequest("/api/patient/"+e+"/assessment","PUT",e,{data:JSON.stringify(t)},function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment list.")}):r(e):r({error:i18next.t("no data returned")})}):(r({error:i18next.t("Questionnaire response data is required.")}),!1):(r({error:i18next.t("User id is required.")}),!1)},assessmentList:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment list.")}):r(e):r({error:i18next.t("no data returned")})})},assessmentReport:function(e,t,r){if(r=r||function(){},!e||!t)return r({error:i18next.t("User id and instrument Id are required.")}),!1;this.sendRequest("/api/patient/"+e+"/assessment/"+t,"GET",e,null,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving assessment report.")}):r(e):r({error:i18next.t("no data returned")})})},getCurrentQB:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("User id is required.")}),!1;r=r||{},this.sendRequest("/api/user/"+e+"/questionnaire_bank","GET",e,{data:{as_of_date:t},sync:r.sync},function(e){if(!e||e.error)return n({error:i18next.t("Error occurred retrieving current questionnaire bank for user.")}),!1;n(e)})},patientReport:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/user_documents?document_type=PatientReport","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving patient report.")}):r(e):r({error:i18next.t("no data returned")})})},setTablePreference:function(e,t,r,n){if(n=n||function(){},r=r||{},!e||!t)return n({error:"User Id and table name is required for setting preference."}),!1;this.sendRequest("/api/user/"+e+"/table_preferences/"+t,"PUT",e,{data:r.data,sync:r.sync},function(e){if(!e||e.error)return n({error:i18next.t("Error occurred setting table preference.")}),!1;n(e)})},getTablePreference:function(e,t,r,n){if(r=r||function(){},n=n||function(){},!e)return n({error:"User Id is required for setting preference."}),!1;this.sendRequest("/api/user/"+e+"/table_preferences/"+t,"GET",e,r,function(e){e&&e.error?n({error:i18next.t("Error occurred setting table preference.")}):n(e)})},emailLog:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/messages","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving email audit entries.")}):r(e):r({error:i18next.t("no data returned")})})},auditLog:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/audit","GET",e,t,function(e){e?e.error?r({error:i18next.t("Error occurred retrieving audit log.")}):r(e):r({error:i18next.t("no data returned")})})},setting:function(e,t,r,n){if(n=n||function(){},!e)return n({error:i18next.t("configuration key is required.")}),!1;r=r||{},this.sendRequest("/api/settings/"+e,"GET",t,{sync:r.sync},function(e){e?e.error?n({error:i18next.t("Error occurred retrieving content for configuration key.")}):n(e):n({error:i18next.t("no data returned")})})},deactivateUser:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/user/"+e,"DELETE",e,t||{},function(e){r=r||function(){},e&&!e.error?r(e):r({error:i18next.t("Error occurred deactivating user.")})})},reactivateUser:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required")}),!1;this.sendRequest("/api/user/"+e+"/reactivate","POST",e,t||{},function(e){e&&!e.error?r(e):r({error:i18next.t("Error occurred reactivating user.")})})},getConfigurationByKey:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("configuration variable name is required.")}),!1;var n="config_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));return r(i),!0}this.sendRequest("/api/settings/"+e,"GET",null,t||{},function(e){e?(r(e),sessionStorage.setItem(n,JSON.stringify(e))):r({error:i18next.t("no data returned")})})},getConfiguration:function(e,t,r){r=r||function(){};var n="settings_"+e;if(sessionStorage.getItem(n)){var i=JSON.parse(sessionStorage.getItem(n));r(i)}else this.sendRequest("/api/settings","GET",e,t||{},function(e){e?(r(e),sessionStorage.setItem(n,JSON.stringify(e))):r({error:i18next.t("no data returned")})})},getEmailReady:function(e,t,r){if(r=r||function(){},!e)return r({error:i18next.t("User id is required.")}),!1;this.sendRequest("/api/user/"+e+"/email_ready","GET",e,t,function(e){r(e)})}}},6:function(e,t,r){"use strict";var n=r(3),i=r(2),o=r(1),s=r(0);t.a={subjectId:"",currentUserId:"",dateFields:["procDay","procMonth","procYear"],entries:[],initCounts:0,init:function(e){var t=this;this.initUserIds(e,function(){if(!t.subjectId)return t.setError(i18next.t("Subject id is required")),!1;t.getOptions(),t.getUserProcedures(),t.initFieldExtension(),t.initFieldEvents()})},initViaTemplate:function(){var e=this;$(document).ready(function(){var t=$("#profileProcSubjectId");t.length&&e.init(t.val())})},initUserIds:function(e,t){t=t||function(){};var r=this;this.setSubjectId(e),n.a.getCurrentUser(function(e){if(!e||e.error)return r.setError(i18next.t("error occurred setting current user id")),void t();r.setCurrentUserId(e.id),r.subjectId||r.setSubjectId(e.id),t()})},setSubjectId:function(e){this.subjectId=e},setCurrentUserId:function(e){this.currentUserId=e},setError:function(e){$("#procDateErrorContainer").html(e||""),e&&$("#procedure_view").html("<p class='text-muted'>"+i18next.t("no data found")+"</p>")},setTreatmentOptionsSelector:function(e){if(e){var t=[];t.push("<option value=''>"+i18next.t("Select")+"</option>"),e.forEach(function(e){t.push("<option value='{value}' data-system='{system}'>{text}</option>".replace("{value}",e.code).replace("{text}",e.text).replace("{system}",e.system))}),$("#tnthproc").append(t.join("")),sessionStorage.setItem("treatmentOptions",JSON.stringify(e))}},getOptions:function(){if($("#tnthproc").length)if(sessionStorage.treatmentOptions)this.setTreatmentOptionsSelector(JSON.parse(sessionStorage.treatmentOptions));else{var e=this,t="/patients/treatment-options";if(window.Worker)return o.a.initWorker(t,{cache:!0},function(t){var r=JSON.parse(t);e.setTreatmentOptionsSelector(r.treatment_options)}),!0;$.ajax({type:"GET",url:t,cache:!0}).done(function(t){e.setTreatmentOptionsSelector(t.treatment_options)}).fail(function(){})}},getCreatorDisplay:function(e,t){return e?String(e)===this.currentUserId?i18next.t("you"):String(e)===String(this.subjectId)?i18next.t("this patient"):i18next.t("staff member")+", <span class='creator'>"+t+"</span>, ":""},getDeleteInvocationDisplay:function(){return $("#popoverHolder .popover__link").html()},setNewEntry:function(e,t){e&&$("#eventListtnthproc").find("tr[data-id='"+t+"'] td.descriptionCell").append("&nbsp; <small class='text-success'><i class='fa fa-check-square-o'></i> <em>"+i18next.t("Added!")+"</em></small>")},setProcedureRowsView:function(){var e="";$("#userProcedures tr[data-id]").each(function(){$(this).find("td").each(function(){$(this).hasClass("list-cell")||$(this).hasClass("lastCell")||(e+="<div>"+$(this).text()+"</div>")})}),$("#procedure_view").html(e||"<p class='text-muted'>"+i18next.t("no data found")+"</p>")},setNoDataDisplay:function(){$("#userProcedures").html("<p id='noEvents'><em>"+i18next.t("You haven't entered any management option yet.")+"</em></p>").animate({opacity:1}),$("#procedure_view").html("<p class='text-muted'>"+i18next.t("no data found")+"</p>"),$("#pastTreatmentsContainer").hide(),$("#eventListLoad").fadeOut()},getUserProcedures:function(e){if(!this.subjectId)return!1;var t=this;$.ajax({type:"GET",url:"/api/patient/"+this.subjectId+"/procedure",cache:!1}).done(function(r){if(0===r.entry.length)return t.setNoDataDisplay(),!1;t.onDidGetProcedures(r.entry,e),$("#eventListLoad").fadeOut()}).fail(function(){t.setError(i18next.t("error occurred retrieving user procedures")),$("#eventListLoad").fadeOut()})},initFieldEvents:function(){var e=this;this.convertToNumericField($("#procYear, #procDay")),setTimeout(function(){$("#tnthproc-submit").eventInput()},150),$("#tnthproc").on("change",function(){$("#tnthproc-submit").attr({"data-name":$(this).val(),"data-system":$(this).find("option:selected").attr("data-system")}),e.checkSubmit("#tnthproc-submit")}),e.dateFields.forEach(function(t){$("#"+t).on("keyup change",function(){e.setDate()})}),$("body").on("click",".data-delete",function(){$(this).closest("tr").remove()})},initPopoverEvents:function(){var e=this;$("[data-toggle='popover']").popover({trigger:"click",placement:"top",html:!0,content:$("#popoverHolder .popover__content").html()}),$("body").on("click",".cancel-delete",function(){$(this).parents("div.popover").prev("a.confirm-delete").trigger("click")}),$("body").on("click",".btn-delete",function(){var t=$(this).parents("tr").attr("data-id");return $(this).parents("tr").fadeOut("slow",function(){$(this).remove(),0===$("#eventListtnthproc tr").length&&e.setNoDataDisplay()}),n.a.deleteProc(t,!1,!1,function(){e.getUserProcedures()}),!1})},onDidGetProcedures:function(e,t){this.populateProcedureRows(e,t),this.setProcedureRowsView(),this.setError(!e||e.error?i18next("Error occurred retrieving procedures"):"")},populateProcedureRows:function(e,t){e.sort(function(e,t){return new Date(t.resource.performedDateTime)-new Date(e.resource.performedDateTime)});var r=this,n=[],o="",a=[],u=0;$.each(e,function(e,t){var o=t.resource.code.coding[0].code,c=t.resource.id;if(-1!==[s.a.CANCER_TREATMENT_CODE,s.a.NONE_TREATMENT_CODE].indexOf(o))return a.push("<input type='hidden' data-id='"+c+"'  data-code='"+o+"' name='otherProcedures' >"),!0;var d=t.resource.meta.by.reference.match(/\d+/)[0],l=r.getCreatorDisplay(d,t.resource.meta.by.display||d),f=new Date(t.resource.meta.lastUpdated),p=i18next.t("(data entered by %actor on %date)").replace("%actor",l).replace("%date",f.toLocaleDateString("en-GB",{day:"numeric",month:"short",year:"numeric"})),h="";String(d)===String(r.currentUserId)&&(h=r.getDeleteInvocationDisplay()),n.push(["<tr data-id='"+c+"' data-code='"+o+"'>","<td width='1%' valign='top' class='list-cell'>&#9679;</td>","<td class='col-md-10 col-xs-10 descriptionCell' valign='top'>"+i.a.formatDateString(t.resource.performedDateTime)+"&nbsp;--&nbsp;"+t.resource.code.coding[0].display+"&nbsp;<em>"+p+"</em></td>","<td class='col-md-2 col-xs-2 lastCell text-left' valign='top'>"+h+"</td>","</tr>"].join("")),u=Math.max(u,c)}),n&&(o='<table  class="table-responsive" width="100%" id="eventListtnthproc" cellspacing="4" cellpadding="6">',o+=n.join(""),o+="</table>",$("#userProcedures").html(o)),this.setNewEntry(t,u),this.initPopoverEvents(),$("#eventListtnthproc tr").length?$("#pastTreatmentsContainer").fadeIn():$("#pastTreatmentsContainer").fadeOut(),$("#userProcedures").append(a.join(""))},handleOtherProcedures:function(){var e=$("#userProcedures input[name='otherProcedures']");if(!e.length)return!1;e.each(function(){var e=$(this).attr("data-code"),t=$(this).attr("data-id");-1!==[s.a.CANCER_TREATMENT_CODE,s.a.NONE_TREATMENT_CODE].indexOf(e)&&n.a.deleteProc(t)})},setAccountCreationRowDisplay:function(e){if(e=e||{},0===$("#pastTreatmentsContainer tr[data-code='"+e.code+"'][data-performedDateTime='"+e.performedDateTime+"']").length){var t=[];t.push("<tr ");var r=[];for(var n in e)r.push("data-"+n+"='"+e[n]+"'");t.push(r.join(" ")),t.push(">"),t.push("<td>&#9679;</td><td>"+e.display+"</td><td>"+e.performedDateTime+"</td><td><a class='btn btn-default btn-xs data-delete'>"+i18next.t("REMOVE")+"</a></td>"),t.push("</tr>"),$("#pastTreatmentsContainer").append(t.join("")),setTimeout(function(){$("#pastTreatmentsContainer").show()},100)}},initFieldExtension:function(){var e=this;$.fn.extend({eventInput:function(){$(this).on("click",function(t){t.stopImmediatePropagation(),$(this).attr("disabled",!0);var r=$(this).attr("data-account-create"),i=e.subjectId,o=$(this).attr("data-name"),s=$(this).attr("data-date"),a=$(this).attr("data-system");if(!o||!s)return!1;var u=$("#tnthproc option:selected").text(),c={resourceType:"Procedure",performedDateTime:s,system:a};if(r)c.display=u,c.code=o,e.setAccountCreationRowDisplay(c);else{e.handleOtherProcedures();var d=[{code:o,display:u,system:a}];c.subject={reference:"Patient/"+i},c.code={coding:d},n.a.postProc(i,c),$("#eventListLoad").show(),setTimeout(function(){e.getUserProcedures(!0)},1800),$("#pastTreatmentsContainer").hide()}return e.reset(),!1})}})},reset:function(){$("#tnthproc").val(""),$("#procDay, #procMonth, #procYear").val(""),$("#tnthproc-submit").addClass("disabled").attr({"data-name":"","data-date":"","data-date-read":"","data-system":""})},checkSubmit:function(e){""!==String($(e).attr("data-name"))&&""!==String($(e).attr("data-date-read"))?$(e).removeClass("disabled").removeAttr("disabled"):$(e).addClass("disabled").attr("disabled",!0)},convertToNumericField:function(e){("ontouchstart"in window||void 0!==window.DocumentTouch&&document instanceof window.DocumentTouch)&&$(e).each(function(){$(this).prop("type","tel")})},isTouchScreen:function(){return"ontouchstart"in window||window.DocumentTouch&&document instanceof window.DocumentTouch},checkDate:function(){var e=$("#procDay"),t=$("#procMonth"),r=$("#procYear"),n=e.val(),o=r.val(),s=$("#procDateErrorContainer");return!(!n||!/(19|20)\d{2}/.test(o)||(i.a.validateDateInputFields(t,e,r,"procDateErrorContainer")?(s.text("").removeClass("error-message"),0):(s.text(i18next.t("The procedure date must be valid and in required format.")).addClass("error-message"),1)))},setDate:function(){if(this.checkDate()){var e=this.dateFields.map(function(e){return $("#"+e).val()}).join("/");$("#tnthproc-submit").attr("data-date-read",e),$("#tnthproc-submit").attr("data-date",i.a.swap_mm_dd(e))}else $("#tnthproc-submit").attr({"data-date-read":"","data-date":""});this.checkSubmit("#tnthproc-submit")}}}});
//# sourceMappingURL=../../maps/coredata.bundle.js.map