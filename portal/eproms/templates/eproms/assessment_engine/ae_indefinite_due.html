{%- from "eproms/assessment_engine/ae_macros.html" import render_header, render_greeting, render_card_content, render_call_to_button, due_card, completed_card, empro_due -%}
{% extends "eproms/assessment_engine/ae_base.html" %}
<!-- User completed baseline, but has outstanding indefinite work -->
{% block head %}
    {% call render_header(title_text=render_greeting(full_name=full_name)) %}
        {{_("Please complete your %(assigning_authority)s questionnaire at your convenience.",
                assigning_authority=_(assessment_status.assigning_authority))}}
    {% endcall %}
{% endblock %}
{% block body %}
    {%- set button_label = _("Continue questionnaire") if unfinished_indefinite_instruments else _("Go to questionnaire") -%}
    <!-- tile title change for subjects enrolled in substudy -->
    {% set title_text = _("%(assigning_authority)s Questionnaire", assigning_authority=_(assessment_status.assigning_authority))
                        if enrolled_in_substudy else _("Open Questionnaire") %}
    <!-- main study due card -->
    {{due_card(assessment_status=assessment_status, button_label=button_label, title_text=title_text)}}
    {%- if enrolled_in_substudy -%}
        {%- if substudy_assessment_is_due -%}
            <!-- substudy due card -->
            {{empro_due(
                substudy_assessment_is_due=substudy_assessment_is_due,
                assessment_status=assessment_status,
                OverallStatus=OverallStatus,
                substudy_assessment_status=substudy_assessment_status,
                substudy_due_date=substudy_due_date,
                enrolled_in_substudy=enrolled_in_substudy
            )}}
        {%- else -%}
            {{completed_card(assessment_status=assessment_status, OverallStatus=OverallStatus, comp_date=comp_date)}}
        {%- endif -%}
    {%- else -%}
        <!-- main study completed tile -->
        {{completed_card(assessment_status=assessment_status, OverallStatus=OverallStatus, comp_date=comp_date, title=_("Completed Questionnaires"))}}
    {%- endif -%}
{% endblock %}
