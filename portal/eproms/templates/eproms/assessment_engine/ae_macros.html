{%- macro render_header(title_text="") -%}
    <div class="portal-header-container">
        <h2 class="portal-header">{{title_text}}</h2>
        <h4 class="portal-intro-text">{{caller()}}</h4>
    </div>
{%- endmacro -%}
{%- macro render_card_content(title_text="", card_class="") -%}
    <div class="portal-description {{card_class}}">
        <h4 class="portal-description-title">
            {{title_text}}
        </h4>
        <div class="portal-description-body">
            <!-- render the card body html from the calling party-->
            {{caller()}}
        </div>
    </div>
{%- endmacro -%}
{%- macro render_logout() -%}
    <div class="button-container portal-header-logout-container">
        <a class="btn-lg btn-tnth-primary" href="/logout">{{ _("Log out") }}</a>
    </div>
{%- endmacro -%}
{%- macro render_call_to_button(button_label="", button_url="") -%}
    <div class="button-container">
        <a class="btn-lg btn-tnth-primary" href="{{button_url}}">{{button_label}}</a>
    </div>
{%- endmacro -%}
{%- macro render_greeting(full_name="") -%}
    {{_("Hi, %(full_name)s.", full_name=full_name if full_name else "")}}
{%- endmacro -%}
{%- macro due_card(
    assessment_status={},
    title_text=_("Open Questionnaire"),
    button_label=_("Go to questionnaire")) -%}
    {%- call render_card_content(
        title_text=_("Open Questionnaire"),
        card_class="portal-description-incomplete") -%}
        <div class="text-content">{{_("Please complete your %(assigning_authority)s questionnaire here.", assigning_authority=_(assessment_status.assigning_authority))}}</div>
        {{render_call_to_button(button_label=button_label, button_url=url_for('assessment_engine_api.present_needed'))}}
    {%- endcall -%}
{%- endmacro -%}
{%- macro completed_card(assessment_status={}, OverallStatus={}, comp_date="", title_text=_("Completed Questionnaires")) -%}
    {%- if assessment_status.overall_status == OverallStatus.completed -%}
        {% call render_card_content(title_text=title_text) %}
            <div class="text-content">
                <a class="portal-weak-auth-disabled" href='{{url_for("portal.profile", _anchor="proAssessmentsLoc")}}'>
                    {{_("View questionnaire completed on %(comp_date)s", comp_date=comp_date)}}
                </a>
            </div>
        {% endcall %}
    {%- else -%}
        {% call render_card_content(title_text=title_text, card_class="disabled") %}
            <div class="text-content">{{_("When you are done, completed questionnaires will be shown here.")}}</div>
        {% endcall %}
    {%- endif -%}
{%- endmacro -%}
{%- macro thankyou_card(full_name="", registry="") -%}
    {% call render_header(title_text=_("Thank you, %(full_name)s.", full_name=full_name if full_name else '')) %}
        <p>{{ _("You've completed the %(registry)s questionnaire.", registry=_(registry)) }}</p>
        <p>{{ _("You will be notified when the next questionnaire is ready to complete.") }}</p>
    {% endcall %}
    {{render_logout()}}
{%- endmacro -%}

<!-- sub-study macro -->
{%- macro empro_due(
                    substudy_assessment_is_due=false,
                    assessment_status={},
                    OverallStatus={},
                    substudy_assessment_status={},
                    substudy_expired_date="",
                    enrolled_in_substudy=false) -%}
    <!-- subject is in the sub-study and the sub-study questionnaire is due-->
    {%- if  enrolled_in_substudy and substudy_assessment_is_due-%}
        {% set substudy_title = "EMPRO" %}
        {% set button_label =  _('complete questionnaire') %}
        {%- call render_card_content(
            title_text=_("%(substudy_title)s Questionnaire", substudy_title=substudy_title),
            card_class="portal-description-incomplete" if assessment_status.overall_status == OverallStatus.completed else "disabled") -%}
            {%- if assessment_status.overall_status != OverallStatus.completed -%}
                {%- if substudy_expired_date -%}
                    <div class="text-content">{{_("Your %(substudy_title)s questionnaire will expire on %(substudy_expired_date)s. Please complete your %(registry)s Questionnaire before being able to complete the sub-study questionnaire.", 
                        substudy_title=substudy_title,
                        substudy_expired_date=substudy_expired_date,
                        registry=_(assessment_status.assigning_authority))}}</div>
                {%- else -%}
                    <div class="text-content">{{_("Complete your %(substudy_title)s questionnaire here. Please complete your %(registry)s Questionnaire before being able to complete the sub-study questionnaire.", 
                        substudy_title=substudy_title,
                        substudy_expired_date=substudy_expired_date,
                        registry=_(assessment_status.assigning_authority))}}</div>
                {%- endif -%}
            {%- else -%}
                <div class="text-content">{{_("Please complete your questionnaire here.  Your responses will create a big impact for future generations of men with Prostate Cancer.")}}</div>, 
                substudy_title=substudy_title,
                substudy_expired_date=substudy_expired_date)}}</div>
            {%- endif -%}
            {{render_call_to_button(button_label=button_label, button_url=url_for('assessment_engine_api.present_needed'))}}
        {%- endcall -%}
    {%- endif -%}
{%- endmacro -%}
<!-- sub-study macro -->
{%- macro empro_completed(
    user=user,
    OverallStatus={},
    substudy_assessment_status={},
    substudy_comp_date="",
    enrolled_in_substudy=false)
-%}
    <!-- subject is in the sub-study and the sub-study questionnaire has been completed -->
    {%- if enrolled_in_substudy and 
        substudy_assessment_status.overall_status == OverallStatus.completed -%}
        {%- set substudy_title = "EMPRO" -%}
        {%- call render_card_content(
            title_text=_("%(substudy_title)s: Get help with your specific issues", substudy_title=substudy_title),
            card_class="portal-description-complete") -%}
            <div class="text-content">
                <!-- this is an anchor link to open thank you modal -->
                <a data-toggle="modal" data-target="#emproModal">{{_("Learn about your specific issues based on your last questionnaire submitted on %(substudy_comp_date)s", substudy_comp_date=substudy_comp_date)}}</a>
            </div>
        {%- endcall -%}
        <!-- TODO link to longitudinal report page -->
        {%- call render_card_content(
            title_text=_("%(substudy_title)s: View how you are doing over time", substudy_title=substudy_title),
            card_class="portal-description-complete") -%}
            <p>{{_("View your longitudinal charts and discuss with your care provider")}}</p>
        {%- endcall -%}
        {{empro_thankyou_modal(user)}}
    {%- endif -%}
{%- endmacro -%}
<!--sub-study macro -->
{%- macro empro_thankyou_modal(user) -%}
    <!-- sub-study modal for display domain topic(s), resources link and summary report link to the user -->
    <div class="modal fade" tabindex="-1" role="dialog" id="emproModal">
        <div class="modal-dialog">
        <div class="modal-content">
            <button type="button" class="close" data-dismiss="modal" aria-label="{{_('Close')}}"><span aria-hidden="true">&times;</span></button>
            <div class="modal-body">
                <div class="header-section">
                    <h2 class="title">{{_("Thank you for completing the IRONMAN EMPRO questionnaire.")}}</h2>
                    <p class="subtitle-text">{{_("We appreciate you sharing your experience and truly value your time.")}}</p>
                </div>
                <div class="items-section">
                    <!-- TODO show this section only if there is hard trigger -->
                    <!-- hard trigger items are hidden by default -->
                    <div class="item hard-trigger-item">
                        <!-- TODO dynamic populate domain topics from call to API !?! -->
                        <p>{{_("You reported having some particular challenges with: ")}}</p>
                        <ul id="hardTriggerDisplayList">
                            <!-- TODO this is the subject's domain topic(s)-->
                            <!--<li>{{_("insomnia")}}</li>-->
                        </ul>
                        <br/>
                        <p><b>{{_("To help address these, we’ve informed your care team and they’ll be in contact with you soon.")}}</b></p>
                        <br/>
                        {% if user and user.organizations %}
                            <p>{{_("In the meantime, if you have any questions or need assistance, please contact your team directly at")}}</p>
                            <p><b>{{user.organizations[0].name}}</b></p>
                        {% endif %}
                    </div>
                    <!-- TODO show this section only if there is hard trigger -->
                    <!-- TODO show this section only if there is soft trigger -->
                    <div class="item hard-trigger-item">
                        <p>{{_("Based on your questionnaire responses, we’ve also gathered information and resources you may find helpful.")}}</p>
                        <div id="hardTriggerButtonsContainer" class="buttons-container">
                            <!--TODO this should be dynamically populated based on the domain topics available to the user-->
                            <!--<button class="btn btn-empro-primary">{{_("insomnia")}}</button>-->
                        </div>
                    </div>
                    <!-- always show -->
                    <div class="item default">
                        <p class="hard-trigger-item">{{_("Our goal is to guide you through managing each challenge with key information and support. To view a full summary of your responses, use the link below.")}}</p>
                        <p class="soft-trigger-item no-trigger-item">{{_("View a full summary of your responses.")}}</p>
                        <!-- TODO point to longitudinal report-->
                        <div class="buttons-container">
                            <button class="btn btn-empro-primary">{{_("View Report")}}</button>
                        </div>
                    </div>
                    <div class="item soft-trigger-item no-trigger-item">
                        <p>{{_("We’ve gathered more information and resources you may find helpful.")}}</p>
                        <div class="buttons-container">
                            <!-- TODO self management pointing to self management landing page -->
                            <a class="btn btn-empro-primary" href="/substudy_tailored_content">{{_("Explore Our Resources")}}</a>
                        </div>
                    </div>
                    <div class="item soft-trigger-item no-trigger-item">
                        <p>{{_("If you have any questions or need assistance, please contact your team directly.")}}</p>
                        <br/>
                        {% if user and user.organizations %}
                            <p>{{_("If you have any questions or need assistance, please contact your team directly at")}}</p>
                            <p><b>{{user.organizations[0].name}}</b></p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        </div>
    </div>
    {{empro_script()}}
{%- endmacro -%}
{%- macro empro_script() -%}
    <script src="{{ url_for('static', filename='js/dist/empro.bundle.js') }}" defer></script>
{%- endmacro -%}

